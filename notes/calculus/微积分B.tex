\documentclass[a4paper,punct=CCT]{ctexbook}

\title{微积分B}
\author{赵磊}

\input{preamble-all}

\newcommand*{\mreason}[1]{#1}
\newcommand*{\ex}[2]{\textbf{例#1：}#2}
\newcommand*{\disp}[1]{\( \displaystyle #1 \)}
\newcommand*{\exds}[2]{\ex{#1}\disp{#2}}
\parasp
\renewcommand{\arraystretch}{1.8}
\newcommand*{\hangpar}[2]{\hangindent=1.2cm \textbf{#1}\\[6pt]#2}
\newcommand*{\veq}{\ensuremath{\mathrel{\:\rotatebox{90}{=}}}}
\newtheoremstyle{break}{}{}{\itshape}{}{\bfseries}{}{\newline}{}
\theoremstyle{break}
\newtheorem*{theorem*}{定理}
\newtheorem*{definition*}{定义}
\newtheorem*{axiom*}{公理}

\usepackage{cancel}
\usepackage{systeme}
\usepackage{caption}

% \usepackage[lite,subscriptcorrection,nofontinfo]{mtpro2}
\usepackage{fontspec}

\defaultfontfeatures{Ligatures=TeX}
\setmainfont{Palatino Linotype}
%\usepackage[integrals]{wasysym}
% \usepackage{fontawesome}

% \xeCJKsetup{CJKecglue=\,}
% \ltjsetparameter{xkanjiskip={0.13\zw plus 1pt minus 1pt}}
\setCJKmainfont{Songti SC}[
  BoldFont = * Black,
  ItalicFont = * Bold
]

\usepackage[math-style=TeX]{unicode-math}
\setmathfont{TeX Gyre Pagella Math}

\usepackage{microtype}

\newif\ifshowsol
\newif\ifshowex
\showsoltrue
\showextrue

\makeatletter
\renewenvironment{proof}[1][\proofname]{\par
  \pushQED{\qed}%
  \normalfont \topsep6\p@\@plus6\p@\relax
  \trivlist
  \item[]\ignorespaces
}{%
  \popQED\endtrivlist\@endpefalse
}
\makeatother

\newenvironment{example}[1][]{\noindent\textbf{例#1：}}{}

\let\reason\text

\AtBeginDocument{%
  % \renewcommand{\perp}{\mathrel{\bot}}
  \let\leq\leqslant
  \let\le\leq
  \let\geq\geqslant
  \let\ge\geq}

\begin{document}
\frontmatter

\maketitle
\thispagestyle{empty}
% \cleardoublepage

\chapter*{前言}

这是我在首期“乘风计划”中《微积分B》课程中做的学习笔记.

\clearpage
\thispagestyle{empty}

\mainmatter

\part{极限理论与一元函数}

\chapter{实数与函数}

\section{实数集的界与确界}

\begin{definition*}
  设\(A\)是一个非空实数集.  若存在\(M > 0\), 使得对任意的\(x \in A\), 都有\(\abs{x} \le M\), 则称实数集\(A\)有界, 称\(M\)为\(A\)的一个界; 若存在\(M_1 \in \R\), 使得对任意的\(x \in A\), 都有\(x \le M_1\), 则称实数集\(A\)有上界, 称\(M_1\)为\(A\)的一个上界; 下界的定义类似.
\end{definition*}

% \pskip
\begin{theorem*}
  实数集有界的充分必要条件是其既有上界, 又有下界.
\end{theorem*}

\begin{proof}
  只证充分性.  设\(M_1, M_2\)分别为实数集的上下界, 取\(M = \max\brce{\abs{M_1}, \abs{M_2}}\), 则\(M\)就是该实数集的一个界.
\end{proof}

\begin{example}
  证明正整数集\(\Z^+\)是无界集.
\end{example}

\begin{proof}
  对于任意的\(M > 0\), 取\(n_0 = \floor M + 1\), 都有\(n_0 \in \Z^+\)且\(n_0 > M\).
\end{proof}

\begin{example}
  证明\(\brce{n \sin \frac{n\pi}2}\)是无界集.
\end{example}

\begin{proof}
  对于所有的\(M > 0\), 取\(n_0 = 2 \floor M + 1\), 那么就有
  \[
    \abs[\Big]{n_0 \sin \frac{n_0\pi}2} = \abs[\Big]{(-1)^{\floor M} n_0} = n_0 = 2 \floor M + 1 > M. \qedhere
  \]
\end{proof}

\begin{definition*}
  实数集\(A\)的最小上界称作上确界, 记作\(\sup A\); 它的最大下界称作下确界, 记作\(\inf A\).
\end{definition*}

\begin{definition*}
  对于实数集\(A\), 如果实数\(M\)满足：\enumparen{1} 对于任意的\(x \in A\), 都有\(x \le M \); \enumparen{2} 对于任意的\(\varepsilon > 0\), 都存在\(x \in A\)使得\(x > M - \varepsilon\), 那么就称\(M\)为\(A\)的上确界.  下确界的定义类似.
\end{definition*}

\begin{example}
  证明\(\inf\brce[\big]{\frac1n} = 0\).
\end{example}

\begin{proof}
  取\(x = \floor{\frac1\varepsilon}\)即可.
\end{proof}

\begin{axiom*}[确界存在公理]
  若非空实数集\(A\)有上界, 则其在实数范围内上有上确界; 若有下界, 则在实数范围内有下确界.
\end{axiom*}

\subsection*{思考}

设\(E \subset R\)为非空实数集, 上确界\(\sup E\)和最大值\(\max E\)有什么和联系区别？下确界\(\inf E\)和最小值\(\min E\)呢？

\section{函数的概念}

\begin{definition*}
  设\(D\)是一个非空实数集, \(f\)是\(D\)上的一个对应关系.  若对任意的\(x \in D\), 都存在唯一的实数\(y\)通过\(f\)与\(x\)对应, 则称\(f\)是定义在\(D\)上的一个函数, 记作\(y = f(x),\ x \in D\).
\end{definition*}

函数的记号是欧拉的, 现代定义最早是由狄利克雷提出的.

\begin{definition*}
  设函数\(f\)在\(D\)上有定义, 称点集\(\brce[\big]{(x,y) \mid y = f(x),\ x \in D}\)为\(f\)的图形.
\end{definition*}

\begin{definition*}[狄利克雷函数]
  \[
    D(x) =
    \begin{cases}
      1, & x \in \Q, \\
      -1, & x \in \R \setminus \Q.
    \end{cases}
  \]
\end{definition*}

\begin{definition*}[阶跃函数]
  \[
    D(x) =
    \begin{cases}
      a, & x \ge x_0, \\
      b, & x < x_0.
    \end{cases}
  \]
\end{definition*}

\begin{definition*}[符号函数]
  \[
    \sgn(x) =
    \begin{cases}
      1, & x > 0, \\
      0, & x = 0, \\
      -1, & x < 0.
    \end{cases}
  \]
\end{definition*}

\begin{definition*}[分段函数]
  在定义域上不能由一个统一的数学表达式表示, 但在定义域的不同范围上能用不同的数学表达式给出的函数称为分段函数.
\end{definition*}

\begin{definition*}[隐函数]
  无法或者不方便显式地来定义, 而是使用代数关系（一般无法写出解析解形式）来确定的函数.
\end{definition*}

\section{函数的运算}

\ifshowex
\subpdfbookmark{练习}{B1.1.3.E}
\subsection*{练习}

\begin{enumerate}
  \setcounter{enumi}{11}
\item 设函数\(f(x) = \frac{2x+3}{x-1}\)且函数\(y = h(x)\)的图像与\(y = f^{-1}(x+1)\)的图像关于直线\(y = x\)对称.  求\(h(3)\)的值.

  \ifshowsol
  这题相当于是求, \(3 = f^{-1}(x+1)\)时, \(x\)的值.
  \fi

\end{enumerate}
\fi


\setcounter{chapter}{5}

\chapter{原函数与不定积分}

\vskip-1.25em
\section{概念与性质}

\textbf{定义：}若函数$f(x)$是函数$ F(x) $在开区间$ \left(a, b\right) $上的导函数,
则称函数$F(x)$为函数$f(x)$在$(a,b)$上的一个原函数.

\textbf{例：} $ f(x) = \sin x $是在$\mathbb{R}$上的一个函数, 则函数$ F(x) = -\cos x $是
$ f(x) $在$ \mathbb{R} $上的一个原函数, 因为$ f(x) = F'(x) $.

\begin{table*}[h]
  \caption*{导数表}
  \centering
  \begin{tabular}{ l l }
    函数		&	导函数 \\
    $F(x)$		&	$f(x)$ \\
    $x^p$		&	$px^{p-1}$ \\
    $e^x$		&	$e^x$ \\
    $a^x$		&	$a^x \cdot \ln a$ \\
    $\ln |x|$	&	$\frac{1}{x}$
  \end{tabular}
  \begin{tabular}{ l l }
    函数			&	导函数 \\
    $F(x)$			&	$f(x)$ \\
    $\log_a |x|$	&	$\frac{1}{x \cdot \ln a}$ \\
    $\sin x$		&	$\cos x$ \\
    $\cos x$		&	$-\sin x$ \\
    $\tan x$		&	$\sec^2 x$
  \end{tabular}
  \begin{tabular}{ l l }
    函数		&	导函数 \\
    $F(x)$		&	$f(x)$ \\
    $\arcsin x$	&	$\frac{1}{\sqrt{1-x^2}}$ \\
    $\arccos x$&	$-\frac{1}{\sqrt{1-x^2}}$ \\
    $\arctan x$&	$\frac{1}{1+x^2}$ \\ {}
  \end{tabular}
\end{table*}

\begin{table*}[h]
  \caption*{原函数表}
  \centering
  \begin{tabular}{ l l }
    函数			&	原函数 \\
    $f(x)$			&	$F(x)$ \\
    $x^p(p\ne-1)$	&	$\frac{1}{p+1} x^{p+1}$ \\
    $e^x$			&	$e^x$ \\
    $a^x$			&	$\frac{a^x}{\ln a}$ \\
    $\frac{1}{x}$	&	$\ln |x|$
  \end{tabular}
  \begin{tabular}{ l l }
    函数						&	原函数 \\
    $f(x)$						&	$F(x)$ \\
    $\sin x$					&	$-\cos x$ \\
    $\cos x$					&	$\sin x$ \\
    $\sec^2 x$					&	$\tan x$ \\
    $\frac{1}{\sqrt{1-x^2}}$	&	$\arcsin x$
  \end{tabular}
  \begin{tabular}{ l l }
    函数						&	原函数 \\
    $f(x)$						&	$F(x)$ \\
    $-\frac{1}{\sqrt{1-x^2}}$	&	$\arccos x$ \\
    $\frac{1}{1+x^2}$			&	$\arctan x$ \\ \\ {}
  \end{tabular}
\end{table*}

\textbf{问题I：}什么样的$f(x)$在$(a,b)$上存在原函数?

\textbf{答：}\parbox[t]{5in}{
(1) $ f \in C(a,b) $, 则$ f $在$(a,b)$内一定存在原函数.（下一章, 即第7章）\\
(2) $f$在$(a,b)$不连续, 是否还有可能存在原函数?}

\hypertarget{E:discontI}{}
\textbf{反例}
\begin{gather*}
	f(x) =
	\begin{cases}
		2x \sin \frac{1}{x} - \cos \frac{1}{x}, & x \ne 0 \\
		0, & x = 0
	\end{cases} \\
	F(x) =
	\begin{cases}
		x^2 \sin \frac{1}{x}, & x \ne 0 \\
		0, & x = 0
	\end{cases}
\end{gather*}
$F(x)$在$\mathbb{R}$上是可导函数, 所以有$F'(x) = f(x)$, \ $x \in \mathbb{R}$.

\textbf{问题II：}什么样的函数$f(x)$在$(a,b)$上没有原函数?

\textbf{答：}要回答这个问题, 我们要先回顾一下微分学中学过的Darboux定理.

\hangpar{Darboux定理：}{
若$F(x)$在$[a,b]$上可导(在$a$点右导数存在, 在b点左导数存在)且$F'(a) = \alpha$,
$F'(b) = \beta$, $\alpha \ne \beta$, 则对于任何介于$\alpha$, $\beta$的实数$\eta$,
存在$\xi \in (a,b) $使得$F'(\xi) = \eta$. (导数的介值定理) }

Darboux定理的逆否命题就说明：不满足介值性质的函数没有原函数.

\textbf{例：}若$f(x)$在$(a,b)$上有第一类间断点, 则$f(x)$在$(a,b)$不满足介值定理,
从而在$(a,b)$上没有原函数.
\[f(x) = \begin{cases}
    1, & x \ge 0 \\
    -1, & x < 0
  \end{cases}\]
$x = 0$是第一类间断点, $f(x)$在$(a,b)\ (a<0, b>0)$上没有原函数.

\textbf{例：}
\[f(x) = \begin{cases}
    2x \sin \frac{1}{x} - \cos \frac{1}{x} + 2, & x \ne 0 \\
    -2, & x = 0
  \end{cases}\]
$x=0$是第二类间断点, $f(x)$在$(a,b)\ (a<0, b>0)$上不存在原函数. (cf.~\hyperlink{E:discontI}{反例})

\textbf{问题III：}若$f(x)$在$(a,b)$上有原函数, 有几个原函数?

\textbf{答：}有无数个.

\hangpar{不同原函数之间的关系：}{
  若$F(x)$是$f(x)$在$(a,b)$内的一个原函数, 则$F(x)+C$均为$f(x)$的原函数, 并且$f(x)$的
  所有原函数构成的集合为$\{F(x)+C\}$, 其中$C \in \mathbb{R}$为任意常数.}

\textbf{证明：}

\vspace{-6pt}
(i) 若$F(x)$是$f(x)$在$(a,b)$上的一个原函数, 则$F'(x)=f(x)$, \ $x\in (a,b)$. 从而$[F(x)+C]' = f(x)$,
\ $x\in (a,b)$, 所以$F(x)+C$都是$f(x)$的原函数.

(ii) 若$G(x)$是$f(x)$在$(a,b)$上的一个原函数, 则$G'(x)=f(x)=F'(x)$, $x\in (a,b)$, 从而$[G(x) - F(x)]' = 0$,
$x \in (a, b)$, 这就意味着 $G(x) - F(x) = C$, 所以$ G(x) = F(x) +C$, $x \in (a, b)$. \qed

我们称$\{F(x)+C\}$为原函数族, 只要找一个原函数为代表, 就能表示所有的原函数.

\textbf{定义：}我们把原函数族称为$f(x)$的不定积分. 记作
\[\{F(x)+C\} = \int f(x) \,dx.\]
\begin{alignat*}{3}
	F&(x) &&\xrightarrow{\text{求导}} &&f(x) \; \text{导函数} \\
	F(x) &+ C &&\xleftarrow[\text{不定积分}]{} &&f(x) \\
	&\veq \\
	\int f(&x) \, dx && &&\text{互为逆过程}
\end{alignat*}

通过上面的原函数表, 给每一个函数加上一个$C$, 就可以构成不定积分表.

\hangpar{不定积分的性质}{
(1) 若$f,g \in R[a,b]$, 则$\int [f(x)+g(x)] \,dx = \int f(x) \,dx + \int g(x) \,dx$\,; \\
(2) 若$f \in R[a,b]$, $\lambda \in \mathbb{R}$, 则$\int [\lambda f(x)] \,dx = \lambda \int f(x) \,dx$.}

\begin{proof}
  \textbf{对(1)的证明：}

  \vspace{-6pt}
  (i) 因为$ (F(x) + G(x))' = F'(x) + G'(x) = f(x) + g(x) $, 所以$ F(x) + G(x) $是$ f(x) + g(x) $的一个原函数.

  (ii)
  \begin{align*}
    \left( \int [f(x) + g(x)] \,dx \right)' = f(x) &+ g(x) \\
                                                   & \veq \\
    \left( \int f(x) \,dx + \int g(x) \,dx \right)' = f(x) &+ g(x) \\
    \intertext{所以}
    \int [f(x) + g(x)] \,dx = \int f(x) \,dx &+ \int g(x) \,dx. \qedhere
  \end{align*}
\end{proof}

\begin{proof}
  \textbf{对(2)的证明：}

  \vspace{-6pt}
  (i) 因为$ (\lambda F(x))' = \lambda F'(x) = \lambda f(x) $, 所以$ \lambda F(x) $是$ \lambda f(x) $的一个原函数.

  (ii)
  \begin{align*}
    \left( \int \lambda f(x) \,dx \right)' = \lambda &f(x) \\
                                                     & \veq \\
    \left( \lambda \int f(x) \,dx \right)' = \lambda &f(x) \\
    \intertext{所以}
    \int \lambda f(x) \,dx = \lambda &\int f(x) \,dx. \qedhere
  \end{align*}
\end{proof}

性质(1)叫做加法法则, 性质(2)叫做数乘法则, 同时使用这两个法则得到:
\[ \int [\lambda f(x) + \mu g(x)] \,dx = \int \lambda f(x) \,dx + \int \mu g(x) \,dx
= \lambda \int f(x) \,dx + \mu \int g(x) \,dx. \]

所谓的减法法则, 可以看成上式的特例:
\[ \int [f(x) - g(x)] \,dx = \int f(x) \,dx - \int g(x) \,dx \quad (\lambda = 1, \mu = -1). \]

\textbf{例1：}$ \displaystyle \int (3x^2 - 2^x) \,dx. $
\begin{align*}
  \int (3x^2 - 2^x) \,dx
  &= 3 \int x^2 \,dx - \int 2^x \,dx \\
  &= 3 \left(\frac{x^3}{3} + C\right) - \left(\frac{2^x}{\ln 2} + C\right) \\
  &= x^3 - \frac{2^x}{\ln 2} + {\color{red} C}.
\end{align*}

\textbf{例2：}$ \displaystyle \int \frac{x^4}{1+x^2} \, dx. $

将这个代入上式
\begin{align*}
  x^4  = (x^4 -1) + 1
  &= (x^2-1)(x^2+1) + 1, \\
  \intertext{得}
  \int \frac{x^4}{1+x^2} \, dx
  &= \int \frac{(x^2-1)(x^2+1) + 1}{1+x^2} \, dx \\
  &= \int \left(x^2 -1 + \frac{1}{1+x^2}\right) \, dx \\
  & = \int x^2 \, dx - \int dx + \int \frac{1}{1+x^2} \, dx \\
  & = \frac{x^3}{3} - x + \arctan x + C.
\end{align*}

\textbf{例3：}$ \displaystyle \int \frac{\cos 2x}{\cos x - \sin x} \, dx. $

将倍角公式代入
\begin{align*}
  \cos 2x = \cos^2 x - \sin^2 x
  &= (\cos x + \sin x)(\cos x - \sin x) \\
  \int \frac{(\cos x + \sin x)\cancel{(\cos x - \sin x)}}{\cancel{\cos x - \sin x}} \, dx
  &= \int (\cos x + \sin x) \, dx \\
  &= \int \cos x \, dx + \int \sin x \, dx \\
  &= \sin x - \cos x + C.
\end{align*}

\textbf{例4：}$ \displaystyle \int \lvert x - 1 \rvert \, dx. $
\begin{align*}
  \lvert x - 1 \rvert
  &= \begin{cases}
    x - 1, & x \ge 1 \\
    1 - x, & x < 1
  \end{cases} \\
  \int \lvert x - 1 \rvert \, dx &= \begin{cases}
    \int (x - 1) \, dx, & x \ge 1 \\
    \int (1 - x) \, dx, & x < 1
  \end{cases} \\
  &= \begin{cases}
    \frac{x^2}{2} - x + C_1, & x \ge 1 \\
    x - \frac{x^2}{2} + C_2, & x < 1
  \end{cases} \\
  \intertext{为了保证$\int \lvert x - 1 \rvert \, dx$在$x=1$处可导, 则必须保证在此处连续. 所以}
  C_1 &= C_2 + 1 \\
  \intertext{设}
  F(x) &= \begin{cases}
    \frac{x^2}{2} - x + 1, & x \ge 1 \\
    x - \frac{x^2}{2}, & x < 1
  \end{cases} \\
  \intertext{则$ F(x) $为$ \lvert x - 1 \rvert $的一个原函数, 就有}
  \int \lvert x - 1 \rvert \, dx & = F(x) + C.
\end{align*}

\section{换元积分法}

\subsection{第一换元法\label{6.2.1}}

设$ \int f(u) \, dx = F(u) + C $且$\varphi(x) \in C^1$,
则$ \int f(\varphi(x)) \varphi'(x) \, dx = F(\varphi(x)) +C $.

\textbf{证明：}$ (\text{左边})' = f(\varphi(x)) \varphi'(x) = (\text{右边})' $. \qed

在实际使用中, 换元法体现了莱布尼茨微分记号的优越性. 将
\begin{align*}
  \varphi'(x) \, dx
  & = d\varphi(x) \\
  \intertext{代入原式, 得}
  \int f(\varphi(x)) \varphi'(x) \, dx
  & = \int f(\varphi(x)) \, d\varphi(x)
    \intertext{用$ u $代替$ \varphi(x) $}
  & = \int f(u) \, du \\
  & = F(u) + C \\
  & = F(\varphi(x)) + C.
\end{align*}

\exds{1}{ \int x \sin x^2 \dx. }

\begin{align*}
  \int x \sin x^2 \dx
  &= \frac{1}{2} \int \sin x^2 \diff(x^2)
  && \mreason{x \dx = \frac12 \diff(x^2)} \\
  &= \frac{1}{2} \int \sin u \du
  && \reason{用$u$代替$x^2$} \\
  &= -\frac{1}{2} \cos u + C \\
  &= -\frac{1}{2} \cos x^2 + C.
\end{align*}

\exds{2}{ \int \cot x \, dx. }

\begin{align*}
  \text{原式}
  &= \int \frac{\cos x}{\sin x} \, dx
  && \mreason{\cot x = \frac{\cos x}{\sin x} } \\
  &= \int \frac{1}{\sin x} \, d(\sin x)
  && \mreason{ d\sin x = \cos x \, dx } \\
  &= \int \frac{du}{u}
  && \mreason{ u = \sin x } \\
  &= \ln \abs{u} + C
  && \mreason{ d\ln \abs{u} = \frac{1}{u} \, du } \\
  &= \ln \abs{\sin x} + C.
  && \mreason{ u = \sin x }
\end{align*}

\hypertarget{E:arctan}{}
\exds{3}{ \int \frac{dx}{a^2 + x^2} \quad (a \ne 0). }

\begin{align}
  \text{原式} &= \frac{1}{a^2} \int \frac{dx}{1+\paren*{\frac{x}{a}}^2}
  && \reason{因为$a \ne 0$, 提取因子$\frac{1}{a^2}$} \notag \\
              &= \frac{1}{a^2} \int \frac{d(au)}{1+u^2}
  && \mreason{ u = \frac{x}{a} } \notag \\
              &= \frac{1}{a} \int \frac{du}{1+u^2}
  && \mreason{ d(au) = a \, du } \notag \\
              &= \frac{1}{a}\arctan u + C
  && \mreason{ d\arctan u = \frac{1}{1+u^2} \, du } \notag \\
              &= \frac{1}{a}\arctan \frac{x}{a} + C.
  && \mreason{ u = \frac{x}{a} } \label{eq:arctanI}
\end{align}

\exds{4}{ \int \frac{dx}{\sqrt{a^2 - x^2}} \quad (a > 0). }

\begin{align*}
  \text{原式} &= \frac{1}{a} \int \frac{dx}{\sqrt{1-\paren*{\frac{x}{a}}^2}}
  && \reason{因为$a > 0$, 提取因子$\frac{1}{a}$} \\
              &= \frac{1}{a} \int \frac{d(au)}{\sqrt{1-u^2}}
  && \mreason{ u = \frac{x}{a} } \\
              &= \int \frac{du}{\sqrt{1-u^2}}
  && \mreason{ d(au) = a \, du } \\
              &= \arcsin u + C
  && \mreason{ d\arcsin u = \frac{1}{\sqrt{1-u^2}} \, du } \\
              &= \arcsin \frac{x}{a} + C.
  && \mreason{ u = \frac{x}{a} }
\end{align*}

\subsection{第二换元法\label{6.2.2}}

设$ f(x) $为连续函数, $ x = \varphi(t) $连续可导且有反函数, 则
\[ \int f(x) \, dx = \int f(\varphi(t)) \varphi'(t) \, dt. \]

若右边的原函数可求得, 记\disp{ G(t) = \int f(\varphi(t)) \varphi'(t) \, dt }, 则
\[ \int f(x) \, dx = G(\varphi^{-1}(x)) + C. \]

\hypertarget{E:sinsub}{}
\exds{1}{ \int \sqrt{a^2 - x^2} \, dx. }

假设$ a > 0 $, 则$ -a \le x \le a$.
\begin{align*}
  \text{原式}
  &= \int a(\sqrt{1-\sin^2 t}) \, d(a\sin t)
  && \mreason{x = a \sin t, \  t \in [-\frac{\pi}{2}, \frac{\pi}{2}] } \\
  &= a^2 \int \cos^2 t \, dt
  && \mreason{ \cos t = \sqrt{1-\sin^2 t},\ d(a\sin t) = a\cos t \, dt } \\
  &= a^2 \int \frac{1+\cos 2t}{2} \, dt
  && \mreason{ \cos^2 t = \frac{1+\cos 2t}{2} } \\
  &= \frac{a^2}{2} t + \frac{a^2}{4} \sin 2t + C
  && \mreason{ d\frac{t}{2} = \frac{1}{2} \, dt,\ d\frac{\sin 2t}{4} = \frac{\cos 2t}{2} \, dt } \\
  &= \frac{a^2}{2} \arcsin \frac{x}{a} + \frac{a^2}{4} \sin(2\arcsin\frac{x}{a}) + C
  && \mreason{ t = \arcsin\frac{x}{a} } \\
  &= \frac{a^2}{2} \arcsin \frac{x}{a} + \frac{x}{2} \sqrt{a^2 - x^2} + C.
\end{align*}

\exds{2}{ \int \frac{dx}{\sqrt{x^2 - a^2}}. }

假设$a>0$, 则$x>a$或$x<-a$.
\begin{align*}
  \text{原式} &= \int \frac{a \sec t \tan t \dt}{a \sqrt{\sec^2 t - 1}}
  && \mreason{ x = a\sec t, \  t \in (0, \frac{\pi}{2}) } \\
              &= \int \frac{ \cancel{a \tan t} \sec t }{\cancel{a \tan t}} \, dt
  && \mreason{ d(a\sec t) = a \sec t \tan t \, dt } \\
              &= \int \frac{dt}{\cos t}
  && \mreason{ \sec t = \frac{1}{\cos t} } \\
              &= \int \frac{\cos t \, dt}{\cos^2 t}
  && \reason{分子分母同乘以$\cos t$} \\
              &= \int \frac{d\sin t}{1 - \sin^2 t}
  && \mreason{ d\sin t = \cos t \, dt, \  \cos^2 t = 1 - \sin^2 t} \\
              &= \int \frac{du}{1-u^2}
  && \mreason{ u = \sin t } \\
              &= \frac{1}{2}\paren*{\int \frac{du}{1-u} + \int \frac{du}{1+u} }
  && \mreason{ \frac{1}{1-u^2} = \frac{1}{2}\paren*{\frac{1}{1-u} + \frac{1}{1+u}} } \\
              &= \frac{1}{2}(\ln \abs{1+u} - \ln \abs{1-u} + C)
  && \mreason{ d\ln \abs{1+u} = \frac{1}{1+u},\ d\ln \abs{1-u} = -\frac{1}{1-u} } \\
              &= \frac{1}{2} \ln \abs[\bigg]{\frac{1+\sin t}{1 - \sin t}} + C
  && \reason{对数的性质, \(u = \sin t\)} \\
              &= \frac{1}{2} \ln \abs[\Bigg]{ \frac{1 + \sqrt{1-\paren{a/x}^2}}
                {1 - \sqrt{1-\paren{a/x}^2}} } + C
  && \mreason{ \sin^2 t = 1 - \paren{a/x}^2} \\
              &= \frac{1}{2} \ln \abs[\Bigg]{ \frac{\paren[\big]{1+\sqrt{1-\paren{a/x}^2}}^2}
                {\paren{a/x}^2} } + C
  && \reason{分母有理化} \\
              % &= \ln \paren[\Big]{x + \sqrt{x^2-a^2}} + C.
              &= \ln \paren[\Big]{x/a + \sqrt{\paren{x/a}^2-1}} + C
  && \reason{对数的性质} \\
              &= \arccosh \frac xa.
  && \reason{反双曲余弦的定义}
\end{align*}

这里用双曲余弦函数\(x = a \cosh u\)做换元, 可使步骤更为简洁, 如下
\begin{align*}
  \int \frac{dx}{\sqrt{x^2 - a^2}}
  = \int \frac{a \sinh u}{a \sqrt{\cosh^2 u - 1}} \du
  = \int \du
  = \arccosh \frac xa + C.
\end{align*}

\exds{3}{ \int \frac{dx}{x^2 \sqrt{x^2+1}}. }

\begin{align*}
  \text{原式} &= \int \frac{\diff \tan t}{\tan^2 t \sqrt{\tan^2 t + 1}}
  && \reason{$x = \tan t$,
     因为$x \ne 0$,
     所以$t \in (-\frac{\pi}{2},\frac{\pi}{2})\setminus\{0\}$} \\
              &= \int \frac{\cancel{\sec t} \sec t \dt}{\cancel{\sec t} \tan^2 t}
  && \mreason{ \sec^2 t - \tan^2 t = 1 } \\
              &= \int \frac{\cos t \dt}{\sin^2 t}
  && \mreason{ \sec t = \frac{1}{\cos t},\  \tan t = \frac{\sin t}{\cos t} } \\
              &= \int \frac{\diff \sin t}{\sin^2 t}
  && \mreason{ \diff \sin t = \cos t \dt } \\
              &= -\frac{1}{\sin t} + C
  && \mreason{ \int u^p \, du = \frac{u^{p+1}}{p+1} + C } \\
              &= -\frac{\sqrt{1+x^2}}{x} + C.
  && \frac{1}{\sin t} = \frac{\sqrt{1+x^2}}{x}
\end{align*}

\ifshowex
\currentpdfbookmark{练习}{B1.6.2.E}
\subsection*{练习}

\begin{enumerate}
\item 若\(f(x)\)的导函数是\(\sin x\), 求\(f(x)\)的原函数.

  \ifshowsol
  这题相当于是求函数\(\sin x\)的原函数的原函数, 所以有
  \[
    \int \paren*{\int \sin x \dx} \dx = \int \paren[\big]{-\cos x + C_1} \dx = -\sin x + C_1 x + C_2.
  \]
  \fi

\item 已知\(f(x)\)的一个原函数是\(\sin x\), \(g(x)\)的一个原函数是\(x^2\), 求复函数\(f(g(x))\)的原函数.

  \ifshowsol
  因为
  \[
    f(x) = \ddx \sin x = \cos x, \quad g(x) = \ddx x^2 = 2x,
  \]
  所以
  \begin{align*}
    \int f(g(x)) \dx
    &= \int \cos 2x \dx \\
    &= \frac12 \int \cos t \dt && \mreason{x = t/2} \\
    &= \frac12 \sin t + C = \frac12 \sin 2x + C.
  \end{align*}
  \fi

\item \disp{\int e^{-\abs{x}} \dx}.

  \ifshowsol
  \begin{align*}
    \int e^{-\abs{x}} \dx
    &=
      \begin{cases}
        \int e^{-x} \dx, & x \ge 0, \\
        \int e^x \dx, & x < 0,
      \end{cases} \\
    &=
      \begin{cases}
        - \int e^{t} \dt, & x \ge 0, \qquad \mreason{x = -t} \\
        e^x + C_2, & x < 0,
      \end{cases} \\
    &=
      \begin{cases}
        -e^t + C_1, & x \ge 0, \\
        e^x + C_2, & x < 0,
      \end{cases} \\
    &=
      \begin{cases}
        -e^{-x} + C_1, & x \ge 0, \qquad \mreason{t = -x} \\
        e^x + C_2, & x < 0,
      \end{cases} \\
    &= C +
      \begin{cases}
        -e^{-x} + 2, & x \ge 0, \\
        e^x, & x <0.
      \end{cases} \quad \reason{\(-1 + C_1 = 1 + C_2\), 取\(C_2 = 0\)}
  \end{align*}
  \fi

\item 已知曲线上任一点的二阶导数\(y'' = 6x\), 且在曲线上点\((0, -2)\)处的切线为\(2x - 3y = 6\), 求这条曲线的方程.

  \ifshowsol
  将切线的方程化为点斜式, 得到\(y = 2x/3 - 2\), 所以\(y'\big\vert_{x=0} = 2/3\).  有
  \[
    y' = \int y'' \dx = \int 6x \dx = 3x^2 + c_1,
  \]
  所以\(c_1 = 2/3\). 又有
  \[
    y = \int y' \dx = \int \paren[\Big]{3x^2 + \frac23} \dx = x^3 + \frac23 x + c_2,
  \]
  所以\(c_2 = -2\).  这条曲线的方程是
  \[
    y = x^3 + \frac23 x - 2.
  \]
  \fi

\item \disp{\int \frac{\ln x}{x^2} \dx}.

  \ifshowsol
  最好的办法是用\(x = e^t\)换元后用分部积分法, 可惜这里还没学到.  有
  \begin{align*}
    \int \frac{\ln x}{x^2} \dx
    &= \int t e^{-t} \dt
    && \mreason{x = e^t} \\
    &= - \int t \diff e^{-t} \\
    &= - \paren[\Big]{t e^{-t} - \int e^{-t} \dt} \\
    &= - t e^{-t} - e^{-t} + C \\
    &= - \frac{\ln x}{x} - \frac1x + C.
  \end{align*}
  \fi

\item 设\(f(x) = e^{-x}\), 求\disp{\int \frac{f'(\ln x)}{x} \dx}.

  \ifshowsol
  使用第一换元法, 有
  \begin{equation*}
    \int \frac{f'(\ln x)}{x} \dx
    = \int f'(\ln x) \diff (\ln x)
    = f(\ln x) = \frac1x + C.
  \end{equation*}

  也可以直接求导\(f'(x) = - e^{-x}\), 然后直接代入, 有
  \begin{equation*}
    \int \frac{f'(\ln x)}{x} \dx
    = - \int \frac{1}{x^2} \dx
    = \frac1x + C.
  \end{equation*}
  \fi

\item 若\disp{\int f(x) \dx = x^2 + C}, 求\disp{\int x \, f(1-x^2) \dx}.

  \ifshowsol
  使用第一换元法, 有
  \begin{align*}
    \int x \, f(1-x^2) \dx
    = - \frac12 \int f(1-x^2) \diff (1-x^2)
    = - \frac12 \paren[\big]{1-x^2}^2 + C.
  \end{align*}

  或者通过求导得到
  \[
    f(x) = \ddx \int f(x) \dx = \ddx (x^2 + C) = 2x,
  \]
  所以
  \[
    \int x \, f(1-x^2) \dx
    = 2 \int x (1-x^2) \dx
    = x^2 - \frac{x^4}{2} + C.
  \]

  上面两种方法得到的答案形式不一样, 但实际上是等价的, 只要把第一个答案中外部的平方展开, 把产生的常数项吸收到后面的任意常数\(C\)中, 就是第二个答案中的形式.
  \fi

\item \disp{\int \frac{x}{(1-x)^3} \dx}.

  \ifshowsol
  尝试使用\(u = 1/(1-x)^2\)和\(t = 1/(1-x)\)来做换元, 观察到
  \[
    \du = \frac{2}{(1-x)^3} \dx
    \quad \text{和} \quad
    \dt = \frac{1}{(1-x)^2} \dx,
  \]
  所以有
  \begin{align*}
    \int \frac{x}{(1-x)^3} \dx
    &= \int \paren[\bigg]{\frac{x-1}{(1-x)^3} + \frac{1}{(1-x)^3}} \dx \\
    &= - \int \frac{1}{(1-x)^2} \dx + \int \frac{1}{(1-x)^3} \dx \\
    &= - \int \dt + \frac12 \int \du \\
    &= - t + \frac u2 + C \\
    &= - \frac1{1-x} + \frac1{2 (1-x)^2} + C.
  \end{align*}
  \fi

\item \disp{\int \frac{\sin x \cos x}{1 + \sin^4 x} \dx}.

  \ifshowsol
  使用\(u = \sin x\)和\(t = u^2\)来做换元, 就有
  \begin{align*}
    \int \frac{\sin x \cos x}{1 + \sin^4 x} \dx
    &= \int \frac{u}{1+u^4} \du
    && \mreason{\du = \cos x \dx} \\
    &= \frac12 \int \frac1{1+t^2} \dt
    && \mreason{\dt = 2u \du} \\
    &= \frac12 \arctan t + C \\
    &= \frac12 \arctan \sin^2 x + C
    && \mreason{t = u^2,\ u = \sin x}
  \end{align*}
  \fi

\item \disp{\int \paren[\big]{2^x + x^2} \dx}.

  \ifshowsol
  \[
    \int \paren[\big]{2^x + x^2} \dx
    = \int 2^x \dx + \int x^2 \dx
    = \frac{2^x}{\ln 2} + \frac{x^3}3 + C.
  \]
  \fi
\end{enumerate}
\fi

\section{分部积分法}

若$u(x)$, $v(x)$连续可导, 则$[u(x) v(x)]' = u'(x)v(x) + u(x)v'(x)$, 就有
\[
  \int u(x) v'(x) \, dx = u(x) v(x) - \int v(x) u'(x) \, dx
\]
或者
\[
  \underset{\text{难}}{\underline{\int u(x) \, dv(x)}} =
  u(x) v(x) - \underset{\text{易}}{\underline{\int v(x) \, du(x)}}.
\]

这种方法适用于函数本身比较难, 但是其导函数比较简单. 这样的函数$ u(x) $一般有
\[
  \begin{matrix}
    \ln x, & \arctan x, & \arcsin x, & \text{函数复杂, 导数简单,} \\
    e^x, & \sin x, & \cos x, & \text{函数导数, 难度相同.}
  \end{matrix}
\]

\exds{1}{\int \ln x \, dx .}
\begin{align*}
  \int \underset{u(x)}{\underline{\ln x}} \, \underset{dv(x)}{\underline{dx}}
  &= x \ln x - \int \underset{v(x)}{\underline{x}} \, \underset{du(x)}{\underline{d\ln x}}
  && \reason{分部积分法} \\
  &= x \ln x - \int dx
  && \mreason{d\ln x = \frac{1}{x} \, dx} \\
  &= x \ln x - x + C .
  && \mreason{dx = dx}
\end{align*}

\exds{2}{\int x \arctan x \, dx .}
\begin{align*}
  \int x \, \underset{u(x)}{\underline{\arctan x}} \, dx
  &= \int \arctan x \, d\frac{x^2}{2}
  && \mreason{d\frac{x^2}{2} = x \, dx} \\
  &= \frac{x^2}{2} \arctan x - \int \frac{x^2}{2} \, d(\arctan x)
  && \reason{分部积分法} \\
  &= \frac{x^2}{2} \arctan x - \int \frac{x^2}{2(1+x^2)} \, dx
  && \mreason{d(\arctan x) = \frac{1}{1+x^2}} \\
  &= \frac{x^2}{2} \arctan x - \frac{1}{2} \int \paren[\bigg]{1 - \frac{1}{1+x^2}} \, dx
  && \mreason{\frac{x^2}{1+x^2} = 1 - \frac{1}{1+x^2}} \\
  &= \frac{1}{2} \paren[\bigg]{x^2 \arctan x - \int dx + \int \frac{dx}{1+x^2}}
  && \reason{积分的加法法则} \\
  &= \frac{1}{2} \brkt[\big]{(x^2+1) \arctan x - x} + C .
  && \mreason{dx = dx,\, d(\arctan x) = \frac{1}{1+x^2}}
\end{align*}

\exds{3}{\int x^2 \, e^x \dx.}
\begin{align*}
  \text{原式}
  &= \int x^2 \diff e^x \\
  &= x^2 e^x - \int e^x \, d(x^2)
  && \reason{分部积分法} \\
  &= x^2 e^x - 2\int x \, de^x \\
  &= x^2 e^x - 2\paren[\Big]{x e^x - \int e^x \, dx}
  && \reason{分部积分法} \\
  &= (x^2 - 2x + 2) e^x + C.
\end{align*}

\exds{4}{\int x \sin(2x) \, dx.}
\begin{align*}
  \text{原式}
  &= \frac{1}{2} \int x \, d[-\cos(2x)] \\
  &= \frac{1}{2} \paren*{\int \cos(2x) \, dx - x \cos(2x)}
  && \reason{分部积分法} \\
  &= \frac{1}{2} \paren[\bigg]{\frac{1}{2} \sin(2x) - x \cos(2x)} + C.
\end{align*}

\exds{5}{\int e^x \sin x \, dx.}
\begin{align*}
  -\int e^x \, d\cos x
  &= \text{原式}
    = \int \sin x \, de^x \\
  - e^x \cos x + \int \cos x \, de^x
  &= \text{原式}
    = e^x \sin x - \int e^x \, d\sin x
  && \reason{分部积分法} \\
  \intertext{因为$\int \cos x \, de^x = \int e^x \cos x \, dx = \int e^x \, d\sin x$, 所以}
  \int e^x \cos x \, dx
  &= \frac{\sin x + \cos x}{2} e^x + C, \\
  \text{原式}
  &= e^x \sin x - \frac{\sin x + \cos x}{2} e^x + C \\
  &= \frac{\sin x - \cos x}{2} e^x + C.
\end{align*}

\section{有理函数的积分}

\subsection{四个特殊函数的不定积分}

\begin{enumerate}
\item \disp{\int \frac A{ax+b} \dx,\ (a \ne 0)}.
  \[
    \frac Aa \int \frac1{x + b/a} \dx
    = \frac Aa \ln \abs[\bigg]{x + \frac ba} + C.
  \]

\item \disp{\int \frac A{(ax+b)^n} \dx, \ (a \ne 0, n \in \N^+ \setminus \brce{1})}.
  \[
    \frac A{a^n} \int \frac1{(x+b/a)^n} \dx
    = \frac A{a^n} \int \frac1{(x+b/a)^n} \diff (x+b/a)
    = - \frac A{a^n (n-1) (x+b/a)^{n-1}} + C.
  \]

\item \disp{\int \frac{Bx+D}{px^2+qx+r} \dx, \ (p \ne 0, \Delta < 0, B \ne 0)}.

  设\(P(x) = px^2 + qx + r\), \(\Delta\)为二次多项式\(P(x)\)的判别式, 则有
  \begin{align*}
    \int \frac{Bx+D}{P(x)} \dx
    &= \frac{B}{2p} \int \frac{P'(x) - q + (2p/B)D}{P(x)} \dx
    && \reason{提取因子\(B/2p\)} \\
    &= \frac{B}{2p} \int \frac{P'(x)}{P(x)} \dx + \paren[\bigg]{D - \frac{B}{2p} q} \int \frac{\dx}{P(x)}
    && \reason{积分的加法法则} \\
    &= \frac{B}{2p} \int \frac{\diff P(x)}{P(x)} + \paren[\bigg]{D - \frac{B}{2p} q} \frac1p \int \frac{\dx}{P(x)/p}
    && \reason{第一换元法} \\
    &= \frac{B}{2p} \ln \abs[\big]{P(x)} + \paren[\bigg]{D - \frac{B}{2p} q} \frac1p \int \frac{\dx}{\paren[\big]{x+\frac{q}{2p}}^2 - \frac{\Delta}{4p^2}}
    && \mreason{\frac{P(x)}{p} = \paren[\Big]{x+\frac{q}{2p}}^2 - \frac{\Delta}{4p^2}} \\
    &= \frac{B}{2p} \ln \abs[\big]{P(x)} + \paren[\bigg]{D - \frac{B}{2p} q} \frac2{\sqrt{-\Delta}} \arctan \frac{P'(x)}{\sqrt{-\Delta}} + C.
    && \mreason{\int \frac{\dx}{x^2 + a^2} = \frac1a \arctan \frac{x}{a}}
  \end{align*}

  上面推导的过程中其实假定了\(p > 0\).  其实当\(p < 0\)时, 上式也成立.

\item \disp{\int \frac{Bx+D}{\paren{px^2+qx+r}^n} \dx, \ (p \ne 0, \Delta < 0, B \ne 0, n \in \N^+ \setminus \brce{1})}.

  设
  \[
    I_{n,a^2}(x) = \int \frac{\dx}{\paren[\big]{x^2 + a^2}^n},
  \]
  那么\(I_{1,a^2}(x)\)就是\ref{6.2.1}中的\hyperlink{E:arctan}{例3}.  此外还有
  \begin{align*}
    I_{n,a^2}(x)
    &= \frac{x}{\paren[\big]{x^2 + a^2}^n} - \int x \diff\brkt[\bigg]{\frac{1}{\paren[\big]{x^2 + a^2}^n}} \\
    &= \frac{x}{\paren[\big]{x^2 + a^2}^n} + 2n \int \frac{x^2}{\paren[\big]{x^2 + a^2}^{n+1}} \dx \\
    &= \frac{x}{\paren[\big]{x^2 + a^2}^n} + 2n \int \brkt[\bigg]{\frac{x^2 + a^2}{\paren[\big]{x^2 + a^2}^{n+1}} - \frac{a^2}{\paren[\big]{x^2 + a^2}^{n+1}}} \dx \\
    &= \frac{x}{\paren[\big]{x^2 + a^2}^n} + 2n \paren[\big]{I_{n,a^2}(x) - a^2 I_{n+1,a^2}(x)},
  \end{align*}
  得到递推关系
  \begin{equation}
    I_{n+1,a^2}(x) = \frac{1}{2na^2} \brkt[\Big]{(2n-1) I_{n,a^2}(x) + \frac{x}{\paren[\big]{x^2 + a^2}^n}}.
  \end{equation}
  用处理第三类特殊函数同样的方法, 得到
  \begin{align*}
    \int \frac{Bx+D}{P^n(x)} \dx
    &= \frac{B}{2p} \int \frac{P'(x) - q + (2p/B)D}{P^n(x)} \dx \\
    &= \frac{B}{2p} \int \frac{P'(x)}{P^n(x)} \dx + \paren[\bigg]{D - \frac{B}{2p} q} \int \frac{\dx}{P^n(x)} \\
    &= \frac{B}{2p} \int \frac{\diff P(x)}{P^n(x)} + \paren[\bigg]{D - \frac{B}{2p} q} \frac1{p^n} \int \frac{\dx}{\brkt*{P(x)/p}^n} \\
    &= \frac{B}{2p} \frac{P^{1-n}(x)}{1-n} + \paren[\bigg]{D - \frac{B}{2p} q} \frac1{p^n} \int \frac{\dx}{\brkt[\Big]{\paren[\big]{x+\frac{q}{2p}}^2 - \frac{\Delta}{4p^2}}^n} \\
    &= \frac{B}{2p} \frac{P^{1-n}(x)}{1-n} + \paren[\bigg]{D - \frac{B}{2p} q} \frac{I_{n,-\Delta/4p^2}\paren*{x+q/2p}}{p^n} + C.
  \end{align*}
\end{enumerate}

\subsection{有理分式函数的化简}

设\(P_n(x)\)和\(Q_m(x)\)分别为\(x\)的\(n\)次和\(m\)次多项式, 则当\(n < m\)时, 称
\[
  \frac{P_n(x)}{Q_m(x)}
\]
为真分式有理函数, 当\(n \ge m\)时, 称之为假分式有理函数.  一个真分式有理函数可以分解成一个多项式与一个假分式有理函数的和的形式.

\exds{1}{\frac{x^4 + 2x^3 + x^2 + 3}{x^2 + 1} = x^2 + 2x + \frac{-2x+3}{x^2 + 1}}.

多项式的不定积分已经解决了, 剩下只要把真分式有理函数分解成前面提到的四类特殊函数的和的形式, 那么有理函数的不定积分就解决了.

\exds{2}{\frac{2x^2 + 2x + 13}{(x-2)\paren{x^2+1}^2}}.

使用待定系数法, 有
\begin{align*}
  \text{原式}
  &= \frac{A}{x-2} + \frac{Bx+C}{x^2+1} + \frac{Dx+E}{\paren{x^2+1}^2} \\
  &= \frac{A\paren{x^2+1}^2
    + \paren{Bx+C}\paren{x-2}\paren{x^2+1}
    + \paren{Dx+E}\paren{x-2}}{%
    (x-2)\paren{x^2+1}^2} \\
  &= \frac{\paren{A + B} x^4
    + \paren{-2B + C} x^3
    + \paren{2A + B - 2C + D}x^2
    + \paren{-2B + C - 2D + E} x
    + \paren{A - 2C - 2E}}{%
    (x-2)\paren{x^2+1}^2}.
\end{align*}
写成方程组的形式
\[
  \hspace*{-2em}
  \systeme{%
    A + B = 0,
    {-2}B + C = 0,
    2A + B - 2C + D = 2,
    {-2}B + C - 2D + E = 2,
    A - 2C - 2E = 13}
  \quad
  \mathrel{\Longrightarrow}
  \qquad
  \systeme{%
    A = 1,
    B = -1,
    C = -2,
    D = -3,
    E = -4},
\]
所以有
\[
  \frac{2x^2 + 2x + 13}{(x-2)\paren{x^2+1}^2}
  = \frac{1}{x-2} - \frac{x+2}{x^2+1} - \frac{3x+4}{\paren{x^2+1}^2}.
\]

\exds{3}{\frac{x^2 + 3x + 1}{(x-2)^2 (x^2 + x + 2)^2}}.

使用待定系数法, 有
\[
  \frac{x^2 + 3x + 1}{(x-2)^2 (x^2 + x + 2)^2}
  = \frac{A}{x-2} + \frac{B}{(x-2)^2} + \frac{Cx+D}{x^2 + x + 2} + \frac{Ex+F}{(x^2 + x + 2)^2}.
\]
右边通分后, 整理成方程组的形式
\[
  \systeme{%
    A + C = 0,
    B - 3C + D = 0,
    A + 2B + 2C - 3D + E = 0,
    {-6}A + 5B - 4C + 2D - 4E + F = 1,
    {-4}A + 4B + 8C - 4D + 4E - 4F = 3,
    {-8}A + 4B + 8D + 4F = 1}
  \quad
  \mathrel{\Longrightarrow}
  \quad
  \systeme{%
    A = -27/256,
    B = 11/64,
    C = 27/256,
    D = 37/256,
    E = -1/64,
    F = -27/64},
\]
所以有
\[
  \frac{x^2 + 3x + 1}{(x-2)^2 (x^2 + x + 2)^2}
  = - \frac{27}{256(x-2)} + \frac{11}{64(x-2)^2} + \frac{27x+37}{256(x^2 + x + 2)} - \frac{x+27}{64(x^2 + x + 2)^2}.
\]

\subsection{有理分式函数的不定积分\label{6.4.3}}

\exds{1}{\int \frac{x^4 + 2x^3 + x^2 + 3}{x^2 + 1} \dx}.
\begin{align*}
  \int \paren[\bigg]{x^2 + 2x + \frac{-2x+3}{x^2 + 1}} \dx
  &= \frac{\,x^3\!}{3} + x^2 - \int \frac{2x}{x^2 + 1} \dx + 3 \int \frac{\dx}{x^2 + 1} \\
  &= \frac{\,x^3\!}{3} + x^2 - \ln\paren{x^2+1} + 3 \arctan x + C.
\end{align*}

\exds{2}{\int \frac{2x^2 + 2x + 13}{(x-2)\paren{x^2+1}^2} \dx}.

\begin{align*}
  \int \frac{2x^2 + 2x + 13}{(x-2)\paren{x^2+1}^2} \dx
  &= \int \brkt[\bigg]{\frac{1}{x-2} - \frac{x+2}{x^2+1} - \frac{3x+4}{\paren{x^2+1}^2}} \dx \\
  &= \ln\abs[\big]{x-2}
    - \frac12 \int \frac{2x}{x^2+1} \dx
    - 2 \int \frac{\dx}{x^2+1} \\
  &\qquad - \frac32 \int \frac{2x}{(x^2+1)^2} \dx - 4 \int \frac{\dx}{(x^2+1)^2} \\
  &= \ln\abs[\big]{x-2} - \frac12 \ln(x^2+1) - 2 \arctan x \\
  &\qquad + \frac{3}{2(x^2+1)} - 4 \, I_{2,1} \\
  &= \ln\abs[\big]{x-2} - \frac12 \ln(x^2+1) - 2 \arctan x \\
  &\qquad + \frac{3}{2(x^2+1)} - 2 \, \paren*{I_{1,1} + \frac{x}{x^2+1}} \\
  &= \ln\abs[\big]{x-2} - \frac12 \ln(x^2+1) - 2 \arctan x \\
  &\qquad + \frac{3}{2(x^2+1)} - 2 \arctan x  - \frac{2x}{x^2+1} + C \\
  &= \ln\frac{\abs{x-2}}{\scriptstyle\sqrt{x^2+1}} - 4 \arctan x + \frac{3-4x}{2(x^2+1)} + C.
\end{align*}

\subsection{三角有理函数的不定积分}

对于\(R(\sin x, \cos x)\)这样带有三角函数的分式有理函数, 可以使用变量替换\(t = \tan\frac{x}{2}\)将其转换成关于\(t\)的有理函数.  因为
\begin{gather*}
  \sin x = \frac{2\tan\frac{x}{2}}{1+\tan^2\frac{x}{2}} = \frac{2t}{1+t^2},
  \quad
  \cos x = \frac{1 - \tan^2\frac{x}{2}}{1+\tan^2\frac{x}{2}} = \frac{1-t^2}{1+t^2}, \\[1ex]
  x = 2 \arctan t,
  \quad
  \dx = \frac{2}{1+t^2} \dt,
\end{gather*}
所以
\[
  R(\sin x, \cos x) \dx = R\paren[\bigg]{\frac{2t}{1+t^2}, \frac{1-t^2}{1+t^2}} \frac{2}{1+t^2} \dt.
\]
设
\[
  I(t) = \int R\paren[\bigg]{\frac{2t}{1+t^2}, \frac{1-t^2}{1+t^2}} \frac{2}{1+t^2} \dt,
\]
则
\[
  \int R(\sin x, \cos x) \dx = I\paren[\Big]{\tan\frac{x}{2}}.
\]

\ifshowex
\currentpdfbookmark{练习}{B1.6.4.E}
\subsection*{练习}

\begin{enumerate}
  \ifshowsol
  \setlength{\itemsep}{10pt plus 4pt minus 4pt}
  \setlength{\abovedisplayskip}{5pt plus 2pt minus 5pt}
  \setlength{\belowdisplayskip}{10pt plus 3pt minus 2pt}
  \fi
\item 设\(\displaystyle J_k = \int \frac{\dx}{\brkt{(x+a)^2 + b^2}^k}\), 求\(J_k\)的递推表达式.

  \ifshowsol
  因为
  \[
    J_k
    = \int \frac{\dx}{\brkt{(x+a)^2 + b^2}^k}
    = \int \frac{\diff(x+a)}{\brkt{(x+a)^2 + b^2}^k}
    = \int \frac{\du}{\paren{u^2 + b^2}^k}
    = I_{k,b^2}(u)
    = I_{k,b^2}(x+a),
  \]
  所以
  \begin{equation*}
    \begin{split}
      J_{k+1}
      = I_{k+1,b^2}(x+a)
      &= \frac{1}{2kb^2} \brce[\bigg]{(2k-1) I_{k,b^2}(x+a) + \frac{x+a}{\brkt{(x+a)^2 + b^2}^k}} \\
      &= \frac{1}{2kb^2} \brce[\bigg]{(2k-1) J_k + \frac{x+a}{\brkt{(x+a)^2 + b^2}^k}}.
    \end{split}
  \end{equation*}
  \fi

\item \(\displaystyle \int \frac{\dx}{(x+a)^2 + b^2} \quad (b \ne 0)\).

  \ifshowsol
  \[
    \int \frac{\dx}{(x+a)^2 + b^2}
    = \int \frac{\diff(x+a)}{(x+a)^2 + b^2}
    = \int \frac{\du}{u^2 + b^2}
    = \frac1b \arctan \frac ub + C
    = \frac1b \arctan \frac{x+a}b + C.
  \]
  \fi

\item \(\displaystyle \int \frac{\dx}{1-x^2}\).

  \ifshowsol
  \[
    \int \frac{\dx}{1-x^2}
    = \arctanh x + C
    = \frac12 \ln\frac{1+x}{1-x} + C.
  \]
  \fi

\item \(\displaystyle \int \frac{t+4}{t^2 + 5t -6} \dt\).

  \ifshowsol
  \[
    \begin{split}
      \int \frac{t+4}{t^2 + 5t -6} \dt
      &= \int \frac{t+4}{(t-1)(t+6)} \dt
      = \frac57 \int \frac{\dt}{t-1} + \frac27 \int \frac{\dt}{t+6} \\
      &= \frac57 \ln\abs[\big]{t-1} + \frac27 \ln\abs[\big]{t+6} + C
      = \frac17 \ln\abs[\big]{(t-1)^5 (t+6)^2} + C.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int \frac{2x^2+2x+13}{(x-2)(x^2+1)^2} \dx\).

  \ifshowsol
  \pskip
  这题就是\ref{6.4.3}的例2.
  \pskip
  \fi

\item \(\displaystyle \int \frac{\dx}{x^4+1}\).

  \ifshowsol
  \[
    \begin{split}
      \int \frac{\dx}{x^4+1}
      &= \int \frac{\dx}{(x^2+1)^2 - 2x^2}
      = \int \frac{\dx}{(x^2+{\scriptstyle\sqrt2}\,x+1)(x^2-{\scriptstyle\sqrt2}\,x+1)} \\
      &= \frac14 \int \paren[\bigg]{\frac{{\scriptstyle\sqrt2}\,x+2}{x^2+{\scriptstyle\sqrt2}\,x+1} - \frac{{\scriptstyle\sqrt2}\,x-2}{x^2+{\scriptstyle\sqrt2}\,x+1}} \dx \\
      &= \frac{\scriptstyle\sqrt2\,}{8} \int \frac{2x+{\scriptstyle\sqrt2}}{x^2+{\scriptstyle\sqrt2}\,x+1} \dx + \frac14 \int \frac{\dx}{x^2+{\scriptstyle\sqrt2}\,x+1} \\
      &\qquad - \frac{\scriptstyle\sqrt2\,}{8} \int \frac{2x-{\scriptstyle\sqrt2}}{x^2-{\scriptstyle\sqrt2}\,x+1} \dx + \frac14 \int \frac{\dx}{x^2-{\scriptstyle\sqrt2}\,x+1} \\
      &= \frac{\scriptstyle\sqrt2\,}{8} \ln\paren[\bigg]{\frac{x^2+{\scriptstyle\sqrt2}\,x+1}{x^2-{\scriptstyle\sqrt2}\,x+1}} + \frac14 \int \frac{\dx}{(x+{\scriptstyle\sqrt2}/2)^2 + 1/2} \\
      &\qquad + \frac14 \int \frac{\dx}{(x-{\scriptstyle\sqrt2}/2)^2 + 1/2} \\
      &= \frac{\scriptstyle\sqrt2\,}{8} \ln\paren[\bigg]{\frac{x^2+{\scriptstyle\sqrt2}\,x+1}{x^2-{\scriptstyle\sqrt2}\,x+1}} + \frac{\scriptstyle\sqrt2\,}4 \int \frac{\diff({\scriptstyle\sqrt2}\,x+1)}{({\scriptstyle\sqrt2}\,x+1)^2 + 1} \\
      &\qquad + \frac{\scriptstyle\sqrt2\,}4 \int \frac{\diff({\scriptstyle\sqrt2}\,x-1)}{({\scriptstyle\sqrt2}\,x-1)^2 + 1} \\
      &= \frac{\scriptstyle\sqrt2\,}{8} \ln\paren[\bigg]{\frac{x^2+{\scriptstyle\sqrt2}\,x+1}{x^2-{\scriptstyle\sqrt2}\,x+1}} + \frac{\scriptstyle\sqrt2\,}4 \brkt*{\arctan({\scriptstyle\sqrt2}\,x+1) + \arctan({\scriptstyle\sqrt2}\,x-1)} + C \\
      &= \frac{\scriptstyle\sqrt2\,}{8} \ln\paren[\bigg]{\frac{x^2+{\scriptstyle\sqrt2}\,x+1}{x^2-{\scriptstyle\sqrt2}\,x+1}} + \frac{\scriptstyle\sqrt2\,}4 \arctan\frac{{\scriptstyle\sqrt2}\,x}{1-x^2} + C.
    \end{split}
  \]
  \fi
\end{enumerate}
\fi

\section{简单无理式的积分\label{6.5}}

类型I

\begin{itemize}
\item \(\displaystyle \int R\paren[\big]{x, \sqrt{(x+p)^2 - q^2}} \dx\), 用\(x + p = q \sec t\)做替换.
\item \(\displaystyle \int R\paren[\big]{x, \sqrt{(x+p)^2 + q^2}} \dx\), 用\(x + p = q \tan t\)做替换.
\item \(\displaystyle \int R\paren[\big]{x, \sqrt{q^2 - (x+p)^2}} \dx\), 用\(x + p = q \sin t\)做替换.
\end{itemize}

前面\ref{6.2.2}的\hyperlink{E:sinsub}{例1}就属于这一类型的替换.

\exds{1}{\int \frac{\dx}{1+\sqrt{x^2+2x+2}}}.

类型II
\[
  \int R\paren[\big]{x, \sqrt[n]{ax+b}} \dx, \quad (a \ne 0).
\]
用
\[
  t = \sqrt[n]{ax+b}, \quad
  x = \frac{t^n-b}{a}, \quad
  \dx = \frac{nt^{n-1}}{a} \dt
\]
做替换, 就有
\[
  \int R\paren[\big]{x, \sqrt[n]{ax+b}} \dx
  = \int R\paren[\Big]{\frac{t^n-b}{a}, t} \frac{nt^{n-1}}{a} \dt.
\]

\exds{2}{\int \frac{x}{\sqrt{x-1}} \dx}.

类型III

\[
  \int R\paren[\Big]{x, \sqrt[n]{\frac{ax+b}{cx+d}}} \dx, \quad (a \ne 0, c \ne 0).
\]
用
\[
  t = \sqrt[n]{\frac{ax+b}{cx+d}}, \quad
  x = \frac{dt^n-b}{a-ct^n}, \quad
  \dx = \frac{(ad-bc)nt^{n-1}}{(a-ct^n)^2} \dt
\]
做替换, 就有
\[
  \int R\paren[\Big]{x, \sqrt[n]{\frac{ax+b}{cx+d}}} \dx
  = \int R\paren[\Big]{\frac{dt^n-b}{a-ct^n}, t} \frac{(ad-bc)nt^{n-1}}{(a-ct^n)^2} \dt.
\]

\hypertarget{E:rootI}{}
\exds{3}{\int \frac{\dx}{\sqrt[3]{(x-1)(x+1)^2}}}.

用\(t = \sqrt[3]{\frac{x+1}{x-1}}\)做换元, 则\(x = \frac{t^3+1}{t^3-1},\ \dx = -\frac{2(3t^2)}{(t^3-1)^2} \dt\), 那么
\[
  \begin{split}
    \int \frac{\dx}{\sqrt[3]{(x-1)(x+1)^2}}
    &= \int \sqrt[3]{\frac{x+1}{x-1}} \frac{\dx}{x+1}
    = \int t \cdot \frac{t^3-1}{2t^3} \cdot \frac{-2(3t^2)}{(t^3-1)^2} \dt
    = -3 \int \frac{\dt}{t^3-1} \\
    &= -3 \int \frac{\dt}{(t-1)(t^2+t+1)}
    = - \int \paren[\Big]{\frac{1}{t-1} - \frac{t+2}{t^2+t+1}} \dt \\
    &= \frac12 \int \frac{2t+1}{t^2+t+1} \dt + \frac32 \int \frac{\dt}{\paren[\big]{t+\frac12}^2+\frac34} - \ln\abs[\big]{t-1} \\
    &= \frac12 \ln(t^2+t+1) - \ln\abs[\big]{t-1} + 2 \int \frac{\dt}{\paren[\Big]{\frac{2t+1}{\scriptscriptstyle\sqrt3}}^2 + 1} \\
    &= \frac12 \ln(t^2+t+1) - \ln\abs[\big]{t-1} + \sqrt3 \arctan \frac{2t+1}{\scriptstyle\sqrt3} + C.
  \end{split}
\]

\ifshowex
\subpdfbookmark{练习}{B1.6.5.E}
\subsection*{练习}

\begin{enumerate}
  \ifshowsol
  \setlength{\parskip}{8pt plus 3pt minus 2pt}
  \setlength{\itemsep}{7pt plus 2pt minus 2pt}
  \setlength{\abovedisplayskip}{7pt plus 5pt minus 2pt}
  \setlength{\belowdisplayskip}{8pt plus 4pt minus 3pt}
  \fi
\item \(\displaystyle \int \frac{\sqrt{x^2 - 2x + 1}}{x-1} \dx\).

  \ifshowsol
  \vspace*{-1em}
  \[
    \int \frac{\sqrt{x^2 - 2x + 1}}{x-1} \dx
    = \int \frac{\sqrt{(x-1)^2}}{x-1} \dx
    = \int \frac{\abs{x-1}}{x-1} \dx
    = \int \sgn(x-1) \dx
    =
    \begin{cases}
      x + C_1, & x > 1, \\
      -x + C_2, & x < 1.
    \end{cases}
  \]
  \fi

\item \(\displaystyle \int \sqrt{e^x+1} \dx\).

  \ifshowsol
  用\(t = \sqrt{e^x + 1}\)做换元, 有
  \[
    \begin{split}
      \int \sqrt{e^x+1} \dx
      &= 2 \int \frac{t^2}{t^2-1} \dx
      = 2 \int \paren[\Big]{1 - \frac{1}{1-t^2}} \dx
      = 2t - \ln\abs[\bigg]{\frac{1+t}{1-t}} + C \\
      &= 2 \sqrt{e^x + 1} - \ln\abs[\Bigg]{\frac{1+\sqrt{e^x + 1}}{1-\sqrt{e^x + 1}}} + C.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int \frac{\dx}{\sqrt[3]{(x-1)(x+1)^2}}\).

  \ifshowsol
  这题就是\ref{6.5}的\hyperlink{E:rootI}{例3}
  \fi

\item \(\displaystyle \int \frac{\dx}{1 + \sin x}\).

  \ifshowsol
  用\(t = \tan\frac{x}{2}\)做换元, 有
  \[
    \begin{split}
      \int \frac{\dx}{1 + \sin x}
      &= \int \frac{1}{\scriptstyle 1 + \tfrac{2t}{1+t^2}} \frac{2}{\scriptstyle 1+t^2} \dt
      = 2 \int \frac{\dt}{t^2+2t+1}
      = 2 \int \frac{\dt}{(t+1)^2} \\
      &= - \frac{2}{t+1} + C
      = - \frac{2}{1+\tan\frac{x}{2}} + C.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int \frac{\dx}{1 - \cos x}\).

  \ifshowsol
  同样用\(t = \tan\frac{x}{2}\)做换元, 有
  \[
    \begin{split}
      \int \frac{dx}{1-\cos x}
      = \int \frac{1}{\scriptstyle 1-\tfrac{1-t^2}{1+t^2}} \frac{2}{1+t^2} \dt
      = \int \frac{dt}{t^2}
      = - \frac1t + C
      = - \cot\frac{x}{2} + C.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int \frac{1 + \sin x}{1 + \cos x} \dx\).

  \ifshowsol
  同样用\(t = \tan\frac{x}{2}\)做换元, 有
  \[
    \begin{split}
      \int \frac{1 + \sin x}{1 + \cos x} \dx
      &= \int \tfrac{1 + \tfrac{2t}{1+t^2}}{1+\tfrac{1-t^2}{1+t^2}} \frac{2}{1+t^2} \dt
      = \int \paren[\Big]{1 + \frac{2t}{1+t^2}} \dt \\
      &= t + \ln\paren{1+t^2} + C
      = \tan\frac{x}{2} + \ln\sec^2\frac{x}{2} + C \\
      &= \tan\frac{x}{2} + \ln\frac{2}{1 + \cos x} + C
      = \tan\frac{x}{2} - \ln\paren{1 + \cos x} + C.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int \frac{\tan x}{a^2 \cos^2 x + b^2 \sin^2 x} \dx,\ (a \ne 0,\ b \ne 0)\).

  \ifshowsol
  用\(u = \tan x\)做换元, 有
  \[
    \begin{split}
      \int \frac{\tan x}{a^2 \cos^2 x + b^2 \sin^2 x} \dx
      &= \int \frac{\tan x}{a^2 + b^2 \tan^2 x} \frac{1}{\cos^2 x} \dx
      = \int \frac{u}{a^2 + b^2 u^2} \du \\
      &= \frac1{2b^2} \ln\paren{a^2 + b^2 u^2} + C
      = \frac1{2b^2} \ln\paren{a^2 + b^2 \tan^2 x} + C.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int \frac{\sin 2x}{\cos^2 x + 2 \sin x} \dx\).

  \ifshowsol
  用\(u = \sin x\)做换元, 有
  \[
    \int \frac{\sin 2x}{\cos^2 x + 2 \sin x} \dx
    = \int \frac{2 \sin x \cos x}{1 - \sin^2 x + 2 \sin x} \dx
    = \int \frac{2u}{1 - u^2 + 2u} \du.
  \]
  上面最右边的式子, 我们可以有两种方式处理.  两种方式处理后得到的结果形式略有不同, 但是变形后其实是一样的.  第一种就是继续部分分式分解, 有
  \[
    \begin{split}
      \int \frac{2u}{1 - u^2 + 2u} \du
      &= - \frac12 \int \paren[\bigg]{\frac{2 + \sqrt2}{u - 1 - \sqrt2} + \frac{2 - \sqrt2}{u - 1 + \sqrt2}} \du \\
      &= - \frac{2+\sqrt2}{2} \ln\abs[\Big]{u - 1 - \sqrt2} - \frac{2-\sqrt2}{2} \ln\abs[\Big]{u - 1 + \sqrt2} + C \\
      &= - \frac{2+\sqrt2}{2} \ln\abs[\Big]{\sin x - 1 - \sqrt2} - \frac{2-\sqrt2}{2} \ln\abs[\Big]{\sin x - 1 + \sqrt2} + C.
    \end{split}
  \]
  第二种就是直接凑微分, 有
  \[
    \begin{split}
      \int \frac{2u}{1 - u^2 + 2u} \du
      &= - \int \paren[\bigg]{\frac{2u-2}{u^2 - 2u - 1} + \frac{2}{u^2 - 2u - 1}} \du \\
      &= - \ln\abs[\Big]{u^2 - 2u - 1} - \frac{\sqrt2}{2} \int \paren[\bigg]{\frac{1}{u - 1 - \sqrt2} - \frac{1}{u - 1 + \sqrt2}} \du \\
      &= - \ln\abs[\Big]{u^2 - 2u - 1} + \frac{\sqrt2}{2} \ln\abs[\Bigg]{\frac{u - 1 + \sqrt2}{u - 1 - \sqrt2}} + C \\
      &= - \ln\abs[\Big]{\cos^2 x + 2 \sin x} + \frac{\sqrt2}{2} \ln\abs[\Bigg]{\frac{\sin x - 1 + \sqrt2}{\sin x - 1 - \sqrt2}} + C.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int \frac{\dx}{\sqrt x \paren{\sqrt x + \sqrt[3]x}}\).

  \ifshowsol
  用\(t = \sqrt[6]x\)做换元, 有
  \[
    \int \frac{\dx}{\sqrt x \paren{\sqrt x + \sqrt[3]x}}
    = \int \frac{6t^5}{t^3(t^3+t^2)} \dt
    = 6 \int \frac{\dt}{t+1}
    = 6 \ln(1+t) + C
    = 6 \ln(1+\sqrt[6]x) + C.
  \]
  \fi

\item \(\displaystyle \int x \sqrt{x+2} \dx\).

  \ifshowsol
  用\(t = \sqrt{x+2}\)做换元, 有
  \[
    \begin{split}
      \int x \sqrt{x+2} \dx
      &= \int \paren{t^2-2}t \cdot 2t \dt
      = \int \paren{2t^4 - 4t^2} \dt \\
      &= \frac25 t^5 - \frac43 t^3 + C
      = \frac25 (x+2)^{5/2} - \frac43 (x+2)^{3/2} + C.
    \end{split}
  \]
  \fi
\end{enumerate}
\fi

\chapter{定积分}

\section{积分概念与积分存在条件}

\ifshowex
\subpdfbookmark{练习}{B1.7.1.E}
\subsection*{练习}

\begin{enumerate}
  \ifshowsol
  \setlength{\parskip}{9pt plus 3pt minus 2pt}
  \setlength{\itemsep}{7pt plus 2pt minus 2pt}
  \fi
\item 估算定积分\(\displaystyle \int_{\sqrt3/3}^{\sqrt3} x \arctan x \dx\)的上下界.

  \ifshowsol
  被积函数是单调递增函数, 这个积分上下限正好是常见的正切值, 求出上和与下和, 有
  \[
    \begin{split}
      (\sqrt3 - \sqrt3/3)\frac{\sqrt3}{3} \arctan \frac{\sqrt3}{3}
      \le
      &\int_{\sqrt3/3}^{\sqrt3} x \arctan x \dx
      \le
      (\sqrt3 - \sqrt3/3) \sqrt3 \arctan\sqrt3, \\
      \frac{\pi}{9}
      \le
      &\int_{\sqrt3/3}^{\sqrt3} x \arctan x \dx
      \le
      \frac23 \pi.
    \end{split}
  \]
  \fi

\item \(\displaystyle \lim_{n\to+\infty} \int_0^{1/2} \frac{x^n}{1+x^2} \dx\).

  \ifshowsol
  当\(n \ge 2\)时, 被积函数是单调递增函数, 所以通过求上和得到一个上界.  这个积分显然是\(\ge 0\)的, 又当\(n\to\infty\)时, 这个上界是极限是\(0\), 所以这个积分的极限是\(0\).
  \fi

\item \(\displaystyle \lim_{n\to+\infty} \int_0^1 \frac{x^n e^x}{1+e^x} \dx\).

  \ifshowsol
  在区间\([0, 1]\)上, 这个被积函数可以看成一个有界变量和\(x^n\)的乘积, 易知\(x^n\)是它的一个上界.  那么只要证明\(\int_0^1 x^n \dx\)的极限是\(0\), 即可证明所求积分的极限也是\(0\).
  \fi

\item 设\(f(x)\)为\((0,+\infty)\)上的单调减函数, 试比较\(\sum_{k=1}^n f(k),\ \int_1^{n+1} f(x) \dx,\ \int_1^{n} f(x) \dx\)的大小关系.

  \ifshowsol
  因为\(f(x)\)是\((0,+\infty)\)上的单调减函数, 所以易知对于任意\(k \ge 1\)都有
  \[
    \int_k^{k+1} f(x) \dx \le f(k) \le \int_{k-1}^k f(x) \dx.
  \]
  那么
  \[
    \int_1^{n+1} f(x) \dx \le \sum_{k=1}^n f(k) \le \int_0^n f(x) \dx, \quad
    \int_2^{n+1} f(x) \dx \le \sum_{k=2}^n f(k) \le \int_1^n f(x) \dx.
  \]
  然后有
  \[
    \int_1^{n+1} f(x) \dx \le \sum_{k=1}^n f(k) = f(1) + \sum_{k=2}^n f(k) \le f(1) + \int_1^n f(x) \dx.
  \]
  \fi

\item \(\displaystyle \lim_{n\to+\infty} \sum_{k=1}^n \frac{n}{n^2+k^2} \).

  \ifshowsol
  将这个和变形得到
  \[
    \sum_{k=1}^n \frac{n}{n^2+k^2}
    = \sum_{k=1}^n \frac1n \frac{1}{1+\paren[\big]{\frac{k}{n}}^2}.
  \]
  这实际上就是函数\(\frac{1}{1+x^2}\)在\([0,1]\)上的一个下和.  那么
  \[
    \lim_{n\to+\infty} \sum_{k=1}^n \frac{n}{n^2+k^2} = \int_0^1 \frac{\dx}{1+x^2} = \frac{\pi}{4}.
  \]
  \fi

\item \(\displaystyle \int_{-1}^1 \paren[\big]{\sin^5 x + \sqrt{1 - x^2}} \dx\).

  \ifshowsol
  将被积函数分解成一个奇函数和一个偶函数, 积分区间是\([-1,1]\), 奇函数抵消掉变成零, 偶函数变成
  \[
    \int_{-1}^1 \paren[\big]{\sin^5 x + \sqrt{1 - x^2}} \dx
    = \int_{-1}^1 \sin^5 x \dx + 2 \int_0^1 \sqrt{1-x^2} \dx
    = \frac{\pi}{2}.
  \]
  \fi

\item \(\displaystyle \int_{-1}^1 x^2 \ln\paren[\big]{x + \sqrt{1 + x^2}} \dx\).

  \ifshowsol
  因为\(\ln\paren[\big]{x + \sqrt{1 + x^2}} = \arcsinh x\)是一个奇函数, \(x^2\)是一个偶函数, 所以他们的乘积还是一个奇函数.  因此
  \[
    \int_{-1}^1 x^2 \ln\paren[\big]{x + \sqrt{1 + x^2}} \dx = 0.
  \]
  \fi

\item 比较\(\displaystyle 0,\ \int_0^{\pi/2} \sin\sin x \dx,\ \int_0^{\pi/2} \cos\sin x \dx\)的大小.
\end{enumerate}
\fi

\section{定积分的性质}

\begin{theorem*}
  \begin{enumerate}
  \item[]
  \item 函数\(f, g \in R[a,b]\)且\(\forall \alpha, \beta \in \R,\ \alpha\,f + \beta\,g \in R[a,b]\), 则
    \[
      \int_a^b \paren{\alpha\,f + \beta\,g} \dx
      = \alpha \int_a^b f \dx + \beta \int_a^b g \dx.
    \]

  \item 函数\(f \in R[a,b]\), 那么\(\forall c \in (a,b)\)有
    \[
      \int_a^b f \dx = \int_a^c f \dx + \int_c^b f \dx.
    \]

  \item 函数\(f \in R[a,b]\), 那么
    \[
      \int_a^b f \dx = - \int_b^a \dx.
    \]
    推论：\(\int_a^a f \dx = 0\).

  \item 函数\(f \in R[a,b]\)且\(f(x) \ge 0\; \forall x \in [a,b]\), 则
    \[
      \int_a^b f \dx \ge 0.
    \]
    推论：函数\(f, g \in R[a,b]\)且\(f(x) \le g(x)\; \forall x \in [a,b]\), 则
    \[
      \int_a^b f \dx \le \int_a^b g \dx.
    \]

  \item 函数\(f \in R[a,b]\), 则\(\abs{\,f} \in R[a,b]\)且
    \[
      \abs[\Big]{\int_a^b f \dx} \le \int_a^b \abs{\,f} \dx.
    \]

  \item 函数\(f \in R[a,b]\), 若\(\forall x \in [a,b]\)都有\(m \le f < M\), 则
    \[
      m(b-a) \le \int_a^b f \dx \le M(b-a).
    \]

  \item 函数\(f \in R[a,b]\), 则\(\exists \xi \in (a,b)\)使得
    \[
      \int_a^b f \dx = f(\xi)(b-a).
    \]

  \item 函数\(f \in C[a,b],\ g \in R[a,b]\)且\(g\)在\([a,b]\)不变号, 则\(\exists \xi \in (a,b)\)使得
    \[
      \int_a^b fg \dx = f(\xi) \int_a^b g \dx.
    \]
  \end{enumerate}
\end{theorem*}

\section{变上限积分与Newton-Leibniz公式}

\ifshowex
\subpdfbookmark{练习}{B1.7.3.E}
\subsection*{练习}

\begin{enumerate}
\item 设
  \[
    f(x) =
    \begin{cases}
      x^2, & x \in [0,1), \\
      x+1, & x \in [1,2],
    \end{cases}
  \]
  试判断
  \[
    F(x) = \int_0^x f(t) \dt
  \]
  在\([0,2]\)上的连续性和可导性.

  \ifshowsol
  对于这个简单的函数, 我们可以写出它的表达式
  \[
    F(x) =
    \begin{cases}
      \frac13 x^3, & x \in [0,1), \\
      \frac12 x^2 + x - \frac76, & x \in [1,2].
    \end{cases}
  \]
  所以易知\(\lim_{x\to1} F(x) = F(1) = \frac13\)和\(F'_-(1) = 1 \ne 2 = F'_+(1)\).  那么\(F\)在\([0,2]\)上连续, 导函数在\(x=1\)处存在第一类间断点.
  \fi

\item 设
  \[
    F(x) = \frac1{x-a} \int_a^x f(t) \dt,
  \]
  其中\(f\)在\([a,b]\)上连续, 在\((a,b)\)内可导且\(f'(x) \le 0\).  试讨论\(F\)在\((a,b)\)上的单调性.

  \ifshowsol
  对该函数求导, 得到
  \[
    \ddx F(x) = \frac{f(x)(x-a) - \int_a^x f(t) \dt}{(x-a)^2}.
  \]
  因为\(f\)在\((a,b)\)上单调递减, 所以
  \[
    f(x)(x-a) \le \int_a^x f(t) \dt.
  \]
  这就意味着\(\ddx F(x) \le 0\), 也就是说\(F\)在\((a,b)\)上单调递减.
  \fi

\item \(\displaystyle \int_0^2 \frac{(x-1)^2 + 1}{(x-1)^2 + x^2 (x-2)^2} \dx\).

  \ifshowsol
  设被积函数为\(f\,\), 那么根据定积分的性质就有
  \[
    \begin{split}
      \int_0^2 f(x) \dx
      &= \int_{-1}^1 f(x+1) \dx
      = \int_{-1}^1 \frac{x^2 + 1}{x^2 + (x+1)^2 (x-1)^2} \dx \\
      &= 2 \int_0^1 \frac{x^2 + 1}{x^2 + (x+1)^2 (x-1)^2} \dx
      = 2 \int_0^1 \frac{1 + \frac{1}{x^2}}{1 + \paren[\big]{\frac{x^2-1}{x}}^2} \dx \\
      &= 2 \int_0^1 \frac{1 + \frac{1}{x^2}}{1 + \paren[\big]{x - \frac{1}{x}}^2} \dx
      = 2 \int_0^1 \frac{\diff\paren[\big]{x - \frac{1}{x}}}{1 + \paren[\big]{x - \frac{1}{x}}^2} \\
      &= 2 \arctan\paren[\Big]{x - \frac{1}{x}}\bigg\vert_0^1
      = 2 \brkt[\Big]{0 - \paren[\Big]{-\frac{\pi}{2}}} \\
      &= \pi.
    \end{split}
  \]
  易知平移后的函数\(f(x+1)\)是一个偶函数.
  \fi

\item 设\(f\)是\([0,+\infty)\)上的连续函数且恒有\(f(x) > 0\), 定义函数
  \[
    g(x) = \frac{\int_0^x t\,f(t) \dt}{\int_0^x f(t) \dt},
  \]
  则下列说法正确的是哪个?
  \begin{enumerate}
  \item \(\displaystyle \lim_{x\to0} g(x) = 1\).
  \item \(g(x)\)在\([0,+\infty)\)上单调增加.
  \item \(\displaystyle \lim_{x\to\infty} g(x) = +\infty\).
  \item \(\displaystyle \lim_{x\to0^+} g'(x)\)不存在.
  \end{enumerate}

  \ifshowsol
  易证\(\lim_{x\to0} g(x) = 0\)和\(\lim_{x\to0^+} g'(x) = 1/2\).  设\(f(t) = e^{-t}\), 那么这个函数就是\enumparen{c}的反例, 因为\(\lim_{x\to\infty} g(x) = 1\).  对于\(g\)求导, 有
  \[
    g'(x) = \frac{x\,f(x) \int_0^x f(t) \dt - f(x) \int_0^x t\,f(t) \dt}{\paren[\big]{\int_0^x f(t) \dt}^2}
    = f(x) \frac{\int_0^x (x-t)\,f(t) \dt}{\paren[\big]{\int_0^x f(t) \dt}^2}.
  \]
  对于所有的\(t \in (0, x)\), 都有\(x - t > 0\)和\(f(t) > 0\), 所以\(\int_0^x (x-t)\,f(t) \dt > 0\).  这就是说在\((0,+\infty)\)上\(g'(x) > 0\), 所以\(g(x)\)在\([0,+\infty)\)上单调增加.
  \fi

\item 已知\(F(x) = \int_a^x f(t) \dt \; (a \le x \le b)\), 则下列结论正确的是哪个?
  \begin{enumerate}
  \item 若函数\(F\)连续, 则\(F' = f\).
  \item 若函数\(f\)连续, 则\(F\)一阶导函数连续.
  \item 函数\(F\)的连续点也是函数\(f\)的连续点.
  \item 若函数\(f\)连续, 则不一定有\(F' = f\).
  \end{enumerate}

\item 关于\(\int_a^x f(t) \dt\), 以下说法正确的是哪个?
  \begin{enumerate}
  \item 函数\(\int_a^x f(t) \dt\)是\(f(x)\)的某一个原函数.
  \item 函数\(\int_a^x f(t) \dt\)是\(f(x)\)的一类原函数族.
  \item 函数\(\int_a^x f(t) \dt\)不一定是\(f(x)\)的原函数.
  \item 若\(\int_a^x f(t) \dt\)是\(f(x)\)的原函数, 则\(f(x)\)连续.
  \end{enumerate}

\item \(\displaystyle \ddx \int_{1/x}^{\cos x} f(t) \dt\).

  \ifshowsol
  \[
    \ddx \int_{1/x}^{\cos x} f(t) \dt
    = \ddx \paren[\Big]{\int_{1/x}^0 f(t) \dt + \int_0^{\cos x} f(t) \dt}
    = \frac{f(1/x)}{x^2} - f(\cos x) \sin x .
  \]
  \fi

\item \(\displaystyle \ddx \int_0^x \sin x \cos t^2 \dt\).

  \ifshowsol
  \[
    \ddx \int_0^x \sin x \cos t^2 \dt
    = \ddx \sin x \int_0^x \cos t^2 \dt
    = \cos x \int_0^x \cos t^2 \dt + \sin x \cos x^2.
  \]
  \fi

\item 求\(x = \int_0^t \sin u \du,\ y = \int_0^t \cos u \du\)所确定的函数对\(x\)的导数\(\dd[y]x\).

  \ifshowsol
  \[
    \dd[y]x = \frac{\dy/\!\dt}{\dx/\!\dt}
    = \frac{\cos t}{\sin t}
    = \cot t.
  \]
  \fi

\item 求由\(\int_0^y e^t \dt + \int_0^x \cos t \dt = 0\)所确定的隐函数对\(x\)的导数\(\dd[y]x\).
  \[
    \begin{split}
      \diff\paren[\Big]{\int_0^y e^t \dt + \int_0^x \cos t \dt}
      &= 0 \\
      e^y \dy + \cos x \dx = 0 \\
      \dd[y]x = - e^{-y} \cos x.
    \end{split}
  \]
\end{enumerate}
\fi

\section{定积分的换元积分法与分部积分法}

\ifshowex
\subpdfbookmark{练习}{B1.7.4.E}
\subsection*{练习}

\begin{enumerate}
\item \(\displaystyle \int_0^a \sqrt{a^2 - x^2} \dx\).

  \ifshowsol
  根据被积函数的几何意义, 有
  \[
    \int_0^a \sqrt{a^2 - x^2} \dx = \frac{\pi a^2}{4}.
  \]
  \fi

\item \(\displaystyle \int_a^{2a} \frac{\sqrt{x^2 - a^2}}{x^4} \dx, \ (a > 0)\).

  \ifshowsol
  用\(x = a \sec t\)做换元, 有
  \[
    \begin{split}
      \int_a^{2a} \frac{\sqrt{x^2 - a^2}}{x^4} \dx
      &= \int_0^{\pi/3} \frac{\sqrt{a^2 \sec^2 t - a^2} \cdot a \tan t \sec t}{a^4 \sec^4 t} \dt
      = \frac{1}{a^2} \int_0^{\pi/3} \frac{\tan^2 t}{\sec^3 t} \dt \\
      &= \frac{1}{a^2} \int_0^{\pi/3} \sin^2 t \cos t \dt
      = \frac{1}{a^2} \int_0^{\sqrt3/2} u^2 \du \\
      &= \frac{1}{a^2} \frac{u^3}{3}\bigg\vert_0^{\sqrt3/2}
      = \frac{\sqrt3}{8a^2}.
    \end{split}
  \]
  也可以用\(x = a \cosh t\)做换元, 有
  \[
    \begin{split}
      \int_a^{2a} \frac{\sqrt{x^2 - a^2}}{x^4} \dx
      &= \int_0^{\arccosh2} \frac{\sqrt{a^2 \cosh^2 t - a^2} \cdot a \sinh t}{a^4 \cosh^4 t} \dt
      = \frac1{a^2} \int_0^{\arccosh2} \tanh^2 t \sech^2 t \dt \\
      &= \frac1{a^2} \int_0^{\tanh\arccosh2} u^2 \du
      = \frac1{a^2} \frac{u^3}{3} \bigg\vert_0^{\sqrt3/2}
      = \frac{\sqrt3}{8a^2}.
    \end{split}
  \]
  其中
  \[
    \tanh\arccosh2 = \tanh\arcsech\frac12 = \sqrt{1 - \sech^2\arcsech\frac12}
    = \sqrt{1 - \frac14} = \frac{\sqrt3}{2}.
  \]
  \fi

\item \(\displaystyle \int_0^3 \frac{x}{1 + \sqrt{1+x}} \dx\).

  \ifshowsol
  用\(t = \sqrt{1+x}\)做换元, 有
  \[
    \int_0^3 \frac{x}{1 + \sqrt{1+x}} \dx
    = \int_1^2 \frac{t^2-1}{1+t} \cdot 2t \dt
    = 2 \int_1^2 \paren{t^2 - t} \dt
    = \frac{2}{3} t^3 \bigg\vert_1^2 - t^2 \bigg\vert_1^2
    = \frac53.
  \]
  \fi

\item \(\displaystyle \int_1^e \frac{1 + \ln x}{x} \dx\).

  \ifshowsol
  \[
    \int_1^e \frac{1 + \ln x}{x} \dx
    = \int_1^e \frac{\dx}{x} + \int_1^e \frac{\ln x}{x} \dx
    = \ln x \bigg\vert_1^e + \frac{\ln^2 x}{2} \bigg\vert_1^e
    = 1 + \frac12 = \frac32.
  \]
  \fi

\item \(\displaystyle \int_0^2 \sqrt{\paren[\big]{4-x^2}^3} \dx\).

  \ifshowsol
  用\(x = 2 \sin t\)做换元, 有
  \[
    \begin{split}
      \int_0^{\pi/2} \sqrt{\paren[\big]{4-x^2}^3} \dx
      &= 16 \int_0^{\pi/2} \cos^4 t \dt
      = 4 \int_0^{\pi/2} \paren[\big]{1 + \cos 2t}^2 \dt \\
      &= 4 \int_0^{\pi/2} \paren{1 + 2 \cos 2t + \cos^2 2t} \dt \\
      &= 4 \paren[\bigg]{\frac{\pi}{2} + \sin 2t \Big\vert_0^{\pi/2} + \frac12 \int_0^\pi \cos^2 u \du} \\
      &= 2 \pi + \int_0^\pi \paren{1 + \cos 2u} \du \\
      &= 2 \pi + \pi + \frac{\sin 2u}{2} \bigg\vert_0^\pi
      = 3 \pi.
    \end{split}
  \]
  \fi
\item \(\displaystyle \int_0^4 \frac{\sqrt x}{1 + x \sqrt{x}} \dx\).

  \ifshowsol
  用\(t = \sqrt x\)做换元, 有
  \[
    \begin{split}
      \int_0^4 \frac{\sqrt x}{1 + x \sqrt{x}} \dx
      = \int_0^2 \frac{t}{1+t^3} \cdot 2t \dt
      = \frac23 \int_0^2 \frac{\diff(t^3)}{1+t^3}
      = \frac23 \ln(1+t^3) \Big\vert_0^2
      = \frac23 \ln9
      = \frac43 \ln3.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int_1^2 x \sqrt{x^2 - 1} \dx\).

  \ifshowsol
  用\(x = \cosh t\)做换元, 有
  \[
    \int_1^2 x \sqrt{x^2 - 1} \dx
    = \int_0^{\arccosh2} \sinh^2 t \cosh t \dt
    = \int_0^{\sinh\arccosh2} u^2 \du
    = \frac{u^3}{3} \bigg\vert_0^{\sqrt3}
    = \sqrt3.
  \]
  其中
  \[
    \sinh\arccosh2 = \sqrt{\cosh^2 \arccosh 2 - 1} = \sqrt{2^2 - 1} = \sqrt3.
  \]
  或者用\(x = \sec t\)做换元, 有
  \[
    \int_1^2 x \sqrt{x^2 - 1} \dx
    = \int_0^{\pi/3} \tan^2 t \sec^2 t \dt
    = \int_0^{\sqrt3} u^2 \du
    = \frac{u^3}{3} \bigg\vert_0^{\sqrt3}
    = \sqrt3.
  \]
  \fi

\item \(\displaystyle \int_0^{2\pi} \frac{\dx}{1 + \cos^2 x}\).

  \ifshowsol
  先将被积函数降次, 然后把积分上下限变换到最小的范围, 最后用\(t = \tan \frac x2\)做换元, 有
  \[
    \begin{split}
      \int_0^{2\pi} \frac{\dx}{1 + \cos^2 x}
      &= \int_0^{2\pi} \frac{2}{3 + \cos 2x} \dx
      = \int_0^{4\pi} \frac{\dx}{3 + \cos x}
      = 2 \int_0^{2\pi} \frac{\dx}{3 + \cos x} \\
      &= 2 \int_{-\pi}^{\pi} \frac{\dx}{3 - \cos x}
      = 4 \int_0^{\pi} \frac{\dx}{3 - \cos x} \\
      &= 4 \int_0^{+\infty} \frac{1}{3 - \paren{1-t^2}/\paren{1+t^2}} \frac{2}{1+t^2} \dt
      = 4 \int_0^{+\infty} \frac{\dt}{1 + 2t^2} \\
      &= \frac{4}{\sqrt2} \arctan \sqrt2 t \bigg\vert_0^{+\infty}
      = \sqrt2 \pi.
    \end{split}
  \]
  \fi

\item 设函数
  \[
    f(x) =
    \begin{cases}
      x, & 0 \le x \le 1, \\
      x^2, & 1 < x \le 2,
    \end{cases}
  \]
  求\(\displaystyle \int_0^2 f(x) \dx\).

  \ifshowsol
  \[
    \int_0^2 f(x) \dx
    = \int_0^1 f(x) \dx + \int_1^2 f(x) \dx
    = \frac{x^2}{2} \bigg\vert_0^1 + \frac{x^3}{3} \bigg\vert_1^2
    = \frac{17}{6}.
  \]
  \fi

\item \(\displaystyle \int_0^3 \paren[\big]{\abs[\big]{x-1} + \abs[\big]{x-2}} \dx\).

  \ifshowsol
  \[
    \begin{split}
      \int_0^3 \paren[\big]{\abs[\big]{x-1} + \abs[\big]{x-2}} \dx
      &= \int_0^1 \paren{3-2x} \dx + \int_1^2 \dx + \int_2^3 \paren{2x-3} \dx \\
      &= \paren{3x-x^2} \Big\vert_0^1 + 1 + \paren{x^2 - 3x} \Big\vert_2^3 \\
      &= 2 + 1 + 2 = 5.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int_0^{2\pi} \abs[\big]{\sin\paren{x-\pi}} \dx\).

  \ifshowsol
  \[
    \int_0^{2\pi} \abs[\big]{\sin\paren{x-\pi}} \dx
    = \int_0^{2\pi} \abs[\big]{- \sin x} \dx
    = \int_0^{2\pi} \abs[\big]{\sin x} \dx
    = 2 \int_0^{\pi} \abs[\big]{\sin x} \dx
    = 2 \int_0^{\pi} \sin x \dx
    = 4.
  \]
  \fi

\item \(\displaystyle \int_0^\pi \frac{x \sin^2 x}{1 + \sin x} \dx\).

  \ifshowsol
  \[
    \begin{split}
      \int_0^\pi \frac{x \sin^2 x}{1 + \sin x} \dx
      &= \int_{-\pi/2}^{\pi/2} \frac{(x+\pi/2) \cos^2 x}{1 + \cos x} \dx
      = \int_{-\pi/2}^{\pi/2} \frac{x \cos^2 x}{1 + \cos x} \dx + \frac\pi2 \int_{-\pi/2}^{\pi/2} \frac{\cos^2 x}{1 + \cos x} \dx \\
      &= \pi \int_0^{\pi/2} \frac{\cos^2 x}{1 + \cos x} \dx
      = \pi \int_0^1 \frac{\brkt[\big]{(1-t^2)/(1+t^2)}^2}{1 + (1-t^2)/(1+t^2)} \cdot \frac2{1+t^2} \dx \\
      &= \pi \int_0^1 \paren[\bigg]{\frac{1-t^2}{1+t^2}}^2 \dt
      = \pi \int_0^1 \brkt[\bigg]{1 - \frac{4t^2}{\paren{1+t^2}^2}} \dt \\
      &= \pi - 4 \pi \int_0^1 \brkt[\bigg]{\frac{1}{1+t^2} - \frac{1}{\paren{1+t^2}^2}} \dt \\
      &= \pi - 4 \pi \arctan t \Big\vert_0^1 + 4 \pi \int_0^1 \frac{\dt}{\paren{1+t^2}^2} \\
      &= \pi - \pi^2 + 4 \pi \int_0^1 \frac{\dt}{\paren{1+t^2}^2}.
    \end{split}
  \]
  现在只要把最后一行剩下的积分求出来就可以了, 注意到
  \[
    \begin{split}
      \int_0^1 \frac{\dt}{1+t^2}
      &= \frac{t}{1+t^2} \bigg\vert_0^1 + 2 \int_0^1 \frac{t^2}{\paren{1+t^2}^2} \dt
      = \frac12 + 2 \int_0^1 \brkt[\bigg]{\frac{1}{1+t^2} - \frac{1}{\paren{1+t^2}^2}} \dt \\
      &= \frac12 + 2 \int_0^1 \frac{\dt}{1+t^2} - 2 \int_0^1 \frac{\dt}{\paren{1+t^2}^2},
    \end{split}
  \]
  所以
  \[
    \int_0^1 \frac{\dt}{\paren{1+t^2}^2}
    = \frac14 + \frac12 \int_0^1 \frac{\dt}{1+t^2}
    = \frac14 + \frac12 \arctan t \Big\vert_0^1
    = \frac14 + \frac\pi8.
  \]
  因此,
  \[
    \int_0^\pi \frac{x \sin^2 x}{1 + \sin x} \dx
    = \pi - \pi^2 + 4 \pi \paren[\bigg]{\frac14 + \frac\pi8}
    = 2 \pi - \frac{\pi^2}{2}.
  \]
  \fi

\item \(\displaystyle \int_0^1 \ln\paren{1+x^2} \dx\).

  \ifshowsol
  \[
    \begin{split}
      \int_0^1 \ln\paren{1+x^2} \dx
      &= x \ln\paren{1+x^2} \Big\vert_0^1 - 2 \int_0^1 \frac{x^2}{1+x^2} \dx
      = \ln2 - 2 \int_0^1 \paren[\bigg]{1 - \frac{1}{1+x^2}} \dx \\
      &= \ln 2 - 2 + 2 \arctan x \Big\vert_0^1
      = \ln 2 - 2 + \frac\pi2.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int_0^1 x \arctan x \dx\).

  \ifshowsol
  \[
    \begin{split}
      \int_0^1 x \arctan x \dx
      &= \frac12 \int_0^1 \arctan x \diff(x^2)
      = \frac12 \paren[\Big]{x^2 \arctan x \Big\vert_0^1 - \int_0^1 \frac{x^2}{1+x^2} \dx} \\
      &= \frac\pi8 - \frac12 + \frac12 \arctan x \Big\vert_0^1
      = \frac\pi4 - \frac12.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int_0^1 x^3 e^{-x^2} \dx\).

  \ifshowsol
  \[
    \begin{split}
      \int_0^1 x^3 e^{-x^2} \dx
      &= - \frac12 \int_0^1 x^2 \diff e^{-x^2}
      = - \frac12 \paren[\Big]{x^2 e^{-x^2} \Big\vert_0^1 - \int_0^1 e^{-x^2} \cdot 2x \dx} \\
      &= - \frac12 \paren[\Big]{e^{-1} + e^{-x^2} \Big\vert_0^1}
      = \frac12 - \frac1e.
    \end{split}
  \]
  \fi

\item \(\displaystyle \int_0^\pi e^x \sin 2x \dx\).

  \ifshowsol
  因为
  \[
    \begin{split}
      \int_0^\pi e^x \sin 2x \dx
      &= e^x \sin 2x \Big\vert_0^\pi - 2 \int_0^\pi e^x \cos 2x \dx
      = -2 \paren[\Big]{e^x \cos 2x \Big\vert_0^\pi + 2 \int_0^\pi e^x \sin 2x \dx} \\
      &= -2(e^\pi - 1) - 4 \int_0^\pi e^x \sin 2x \dx.
    \end{split}
  \]
  所以
  \[
    \int_0^\pi e^x \sin 2x \dx = -\frac25 (e^\pi - 1).
  \]
  \fi
\end{enumerate}
\fi

\section{定积分的几何应用}

\ifshowex
\subpdfbookmark{练习}{B1.7.5.E}
\subsection*{练习}
\fi


\section{定积分的物理应用}

\section{反常积分}

\ifshowex
\subpdfbookmark{练习}{B1.7.7.E}
\subsection*{练习}
\fi

\end{document}
